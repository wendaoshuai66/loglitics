var app=angular.module("MetronicApp",["ui.router","ui.bootstrap","oc.lazyLoad","ngSanitize","ui.select2","w5c.validator","frapontillo.bootstrap-switch","ngProgress"]);app.config(["$ocLazyLoadProvider",function($ocLazyLoadProvider){$ocLazyLoadProvider.config({})}]),app.config(["$controllerProvider",function($controllerProvider){$controllerProvider.allowGlobals()}]),app.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.transformRequest=function(data){return void 0===data?data:$.param(data)},$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"}]),app.config(["w5cValidatorProvider",function(w5cValidatorProvider){w5cValidatorProvider.config({blurTrig:!1,showError:!0,removeError:!0}),w5cValidatorProvider.setRules({email:{required:"邮箱不能为空",email:"邮箱格式不正确"},userName:{required:"用户名不能为空",pattern:"用户名必须输入字母、数字、下划线,以字母开头"},password:{required:"密码不能为空",minlength:"密码长度不能小于{minlength}",maxlength:"密码长度不能大于{maxlength}"},number:{required:"数字不能为空"},positiveInteger:{required:"数字不能为空",pattern:"数字只能为正整数"},doubleNumber:{required:"数字不能为空",pattern:"只能为正数，且最多两位小数"},modelName:{required:"型号名称不能为空",pattern:"型号名称不符合规范",minlength:"型号名称长度不能小于{minlength}",maxlength:"型号名称长度不能大于{maxlength}"},moduleName:{required:"模块名称不能为空",pattern:"模块名称不符合规范",minlength:"模块名称长度不能小于{minlength}",maxlength:"模块名称长度不能大于{maxlength}"},reply:{required:"回复内容不能为空"},personName:{required:"人员名称不能为空",pattern:"人员名称不符合规范",minlength:"人员名称长度不能小于{minlength}",maxlength:"人员名称长度不能大于{maxlength}"},personName2:{required:"人员名称不能为空",pattern:"人员名称不符合规范",minlength:"人员名称长度不能小于{minlength}",maxlength:"人员名称长度不能大于{maxlength}"},documents:{required:"单号名称不能为空",pattern:"单号名称不符合规范",minlength:"单号名称长度不能小于{minlength}",maxlength:"单号名称长度不能大于{maxlength}"},address:{required:"地点名称不能为空",pattern:"地点名称不符合规范",minlength:"地点名称长度不能小于{minlength}",maxlength:"地点名称长度不能大于{maxlength}"},name:{required:"名称不能为空",pattern:"名称不符合规范",minlength:"名称长度不能小于{minlength}",maxlength:"名称长度不能大于{maxlength}"},name2:{required:"输入不能为空",pattern:"输入不符合规范",minlength:"输入长度不能小于{minlength}",maxlength:"输入长度不能大于{maxlength}"},name3:{required:"输入不能为空",pattern:"输入不符合规范",minlength:"输入长度不能小于{minlength}",maxlength:"输入长度不能大于{maxlength}"},name4:{required:"输入不能为空",pattern:"输入不符合规范",minlength:"输入长度不能小于{minlength}",maxlength:"输入长度不能大于{maxlength}"},name5:{required:"输入不能为空",pattern:"输入不符合规范",minlength:"输入长度不能小于{minlength}",maxlength:"输入长度不能大于{maxlength}"},title:{required:"标题不能为空",pattern:"标题不符合规范",minlength:"标题长度不能小于{minlength}",maxlength:"标题长度不能大于{maxlength}"},url:{required:"链接不能为空",pattern:"链接不符合规范",minlength:"链接长度不能小于{minlength}",maxlength:"链接长度不能大于{maxlength}"},select:{required:"下拉框内容不能为空"},select2:{required:"下拉框内容不能为空"},select3:{required:"下拉框内容不能为空"},multipleSelect:{required:"多选下拉框内容不能为空"},multipleSelect2:{required:"多选下拉框内容不能为空"},multipleSelect3:{required:"多选下拉框内容不能为空"},multipleSelect4:{required:"多选下拉框内容不能为空"},idCardNum:{required:"身份证号不能为空",pattern:"身份证号格式不正确"},phoneNum:{required:"手机号不能为空",pattern:"手机号格式不正确"},date:{required:"日期不能为空"},description:{required:"内容不能为空",minlength:"内容长度不能小于{minlength}",maxlength:"内容长度不能大于{maxlength}"},registerName:{required:"账号不能为空",pattern:"只能为字母、数字,不能为纯数字或字母",minlength:"账号只能为8位",maxlength:"账号只能为8位"}})}]),app.factory("settings",["$rootScope",function($rootScope){var settings={layout:{pageSidebarClosed:!1,pageContentWhite:!0,pageBodySolid:!1,pageAutoScrollOnLoad:1e3},assetsPath:"../assets",globalPath:"../assets/global",layoutPath:"../assets/layouts/layout"};return $rootScope.settings=settings,settings}]),app.controller("AppController",["$scope","$rootScope","$location","$timeout","$http","$q","ngProgressFactory","$window","$state","$compile",function($scope,$rootScope,$location,$timeout,$http,$q,ngProgressFactory,$window,$state,$compile){$rootScope.getToken=function(){return localStorage.getItem("com.logistics.user.token")},$rootScope.getLoginUser=function(){$rootScope.loginUser=JSON.parse(localStorage.getItem("com.logistics.user.info"))},$scope.getLoginUser(),$scope.$on("$viewContentLoaded",function(){App.initAjax()}),$rootScope.progressbar=ngProgressFactory.createInstance(),$rootScope.progressbar.setHeight("4px"),$rootScope.progressbar.setColor("#36D7B7"),$rootScope.$on("$locationChangeStart",function(){var flag=100!==$rootScope.progressbar.status();flag?$rootScope.progressbar.set(100):($rootScope.progressbar.start(),$timeout(function(){flag&&$rootScope.progressbar.complete()},3e3))}),$rootScope.$on("$viewContentLoaded",function(){$rootScope.progressbar.complete()}),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if("dutyRegister"===fromState.name)for(var key in localStorage)-1!==key.indexOf("com.logistics.duty")&&localStorage.removeItem(key);var token=localStorage.getItem("com.logistics.user.token"),loginStatus=localStorage.getItem("com.logistics.user.login"),redirectToLogin=function(callback){localStorage.setItem("com.logistics.user.token",null),localStorage.setItem("com.logistics.user.login",!1),localStorage.setItem("com.logistics.user.expired",!0),localStorage.setItem("com.logistics.user.info",null),callback&&callback(),$rootScope.userLogin()};1==loginStatus||"true"==loginStatus?$http({url:httpDomain+"checkAuthority",method:"POST",data:{administrator:!0},headers:{"logistics-session-token":token}}).success(function(data){null==data||""==data?redirectToLogin():"SUCCESS"!==data.status&&("EXPIRED"===data.status?redirectToLogin():"NOADMINISTRATOR"===data.status&&redirectToLogin(function(){localStorage.setItem("com.logistics.user.expired","NOADMINISTRATOR")}))}).error(function(){redirectToLogin()}):$rootScope.userLogin()}),$rootScope.httpDomain=httpDomain,$rootScope.schoolName=schoolName,$rootScope.ifOpenApi=ifOpenApi,$rootScope.maxAlarmValue=maxAlarmValue,$rootScope.formatState=function(state){if(!state.id)return state.text;for(var levelList=$rootScope.getScope([$rootScope.select2InitCountolerName]).levelList,nbsp="",split=state.id.split("number:"),id=split[split.length-1],p=0;p<levelList.length;p++)if(levelList[p].id==id)for(var i=0;i<levelList[p].level;i++)nbsp+="&nbsp;&nbsp;&nbsp;&nbsp;";return $("<span>"+nbsp+state.text+"</span>")},$rootScope.select2FormatOptions={language:"zh-CN",templateResult:$rootScope.formatState},$rootScope.select2Options={language:"zh-CN"},$rootScope.multipleSelect2={closeOnSelect:!1,language:"zh-CN"},$rootScope.select2NoSearch={minimumResultsForSearch:-1,language:"zh-CN"},$rootScope.validateOptions={blurTrig:!0},$rootScope.regex={name:/^[\u4e00-\u9fa5_a-zA-Z0-9]+$/,telNum:/^1(3|4|5|7|8)\d{9}$/,idCardNum:/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/,ip:/^((?:(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d))))$/,enName:/^[a-zA-Z0-9]+$/,positiveInteger:/^[0-9]*[1-9][0-9]*$/,twoDecimal:/^(([1-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/,url:/^((ht|f)tps?):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]$/,personName:/^[\u4e00-\u9fa5a-zA-Z]+$/,chineseName:/^[\u4e00-\u9fa5]+$/,registerAccount:/^[a-zA-Z0-9]*([a-zA-Z][0-9]|[0-9][a-zA-Z])[a-zA-Z0-9]*$/},$rootScope.length={accountMin:8,accountMax:8,shortNameMin:1,shortNameMax:5,simpleNameMin:1,simpleNameMax:10,langNameMin:1,langNameMax:20,addressMin:1,addressMax:50,contentMin:25,contentMax:150,modelMin:1,modelMax:30,passwordMin:6,passwordMax:20,personMin:2,personMax:10,linkNameMin:2,linkNameMax:15,storageCountMin:1,storageCountMax:15,commentMin:5,commentMax:200},$rootScope.loadingConfig={loadingWidth:120,title:"",name:"test",discription:"",direction:"column",type:"origin",originDivWidth:40,originDivHeight:40,originWidth:6,originHeight:6,smallLoading:!1,loadingMaskBg:"rgba(0,0,0,0.2)"},$rootScope.addLoading=function(){$("body").loading($rootScope.loadingConfig)},$rootScope.removeLoading=function(){removeLoading("test")},$rootScope.toNewPage=function($scope,data){var pageState=data.pageState;$scope.$state.go(pageState,{messageData:data})},$rootScope.removeModal=function(id){$rootScope.removeId=id,$("#removeModal").modal()},$rootScope.resetPswModal=function(id){$rootScope.resetPswId=id,$("#resetPswModal").modal()},$rootScope.searchInfo=function($scope){$rootScope.addLoading();var tableStr="dataTable";$scope.initDataTablesName&&(tableStr=$scope.initDataTablesName),$("#"+tableStr).DataTable().ajax.reload(function(){$rootScope.removeLoading()},!0)},$rootScope.clearQueue=function(){$scope.getScope("slideUpload").uploader.clearQueue(),$("#myUpload").val("")},$rootScope.postApi=function($scope,callBack){var deferred=$q.defer();return $rootScope.ifOpenApi&&$http({url:$scope.httpDomain+$scope.url,method:"POST",data:$scope.params,headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data,status,headers,config){if("SUCCESS"===data.status?($scope.optName&&""!=$scope.optName&&sweetAlert("提示",$scope.optName+"成功！","success"),deferred.resolve()):("storage"===$scope.controllerName&&"NOSTORAGE"===data.status?sweetAlert("警告","不允许删除,该删除入库数量大于当前物料库存数量!","warning"):sweetAlert("警告",$scope.optName+"失败！","error"),deferred.reject()),$scope.stateNewPage)$scope.removeLoading(),$scope.$state.go($scope.returnControllerName,{messageData:null});else{$scope.url=$scope.reloadUrl;var tableStr="dataTable";$scope.initDataTablesName&&(tableStr=$scope.initDataTablesName);var refresh=!1;void 0===$scope.data.id&&1==$scope.dataRefresh&&(refresh=!0,$scope.dataRefresh=!1),$("#"+tableStr).DataTable().ajax.reload(function(){$scope.removeLoading(),null!=callBack&&callBack()},refresh)}}).error(function(data,status,headers,config){sweetAlert("警告",$scope.optName+"异常！","error"),$scope.removeLoading(),deferred.reject()}),$scope.ifOpenApi||$scope.changeStatusType&&$scope.changeStatusId&&($scope[$scope.changeStatusType+$scope.changeStatusId]=!$scope[$scope.changeStatusType+$scope.changeStatusId]),$scope.removeLoading(),deferred.promise},$rootScope.postApiNoReload=function($scope){var deferred=$q.defer();return $rootScope.ifOpenApi&&$http({url:$scope.httpDomain+$scope.url,method:"POST",data:$scope.params,headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data,status,headers,config){"SUCCESS"===data.status?(sweetAlert("提示",$scope.optName+"成功！","success"),deferred.resolve()):(sweetAlert("警告",$scope.optName+"失败！","error"),deferred.reject()),$scope.url=$scope.reloadUrl,$scope.removeLoading()}).error(function(data,status,headers,config){sweetAlert("警告",$scope.optName+"异常！","error"),$scope.removeLoading(),deferred.reject()}),$scope.ifOpenApi||$scope.removeLoading(),deferred.promise},$rootScope.getSelectInfoApi=function($scope){if(null!=$scope){var deferred=$q.defer();return $rootScope.ifOpenApi&&$http({url:$scope.httpDomain+$scope.selectUrl,method:"POST",data:$scope.selectParams,headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data){null!=data.data?($scope[$scope.selectPara]=data.data,deferred.resolve()):(sweetAlert("警告",$scope.selectOptName+"失败！","error"),deferred.reject())}).error(function(){sweetAlert("警告",$scope.selectOptName+"异常！","error"),deferred.reject()}),deferred.promise}},$scope.materialLessAlarmCount=0,$scope.getMaterialLessAlarmInfo=function(){$rootScope.ifOpenApi&&$http({url:$scope.httpDomain+"checkMaterialLessAlarmValue",method:"POST",headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data){null!=data.data&&($scope.materialLessAlarmInfo=data.data,$scope.materialLessAlarmCount=data.count)})},$scope.getMaterialLessAlarmInfo();var timeout;$rootScope.checkRepeatApi=function($scope){$scope.params={data:""},$scope.data[$scope.checkRepeatName]&&($scope.ifRepeat=!0,timeout&&$timeout.cancel(timeout),$scope.params={data:JSON.stringify($scope.data)}),$rootScope.ifOpenApi&&(timeout=$timeout(function(){$http({url:$scope.httpDomain+$scope.repeatUrl,method:"POST",data:$scope.params,headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data,status,headers,config){"REPEAT"===data.status?sweetAlert("警告",$scope.repeatName+"重复！请更换再试！","warning"):$scope.ifRepeat=!1}).error(function(data,status,headers,config){sweetAlert("警告",$scope.repeatName+"校验异常！","error")}),timeout=null},800))},$rootScope.getStatusHtml=function($scope,id,type,value){var disabledHtml="";return"inforPicture"==$scope.controllerName?("slideShow"===type&&value&&(disabledHtml="myDisabled"),"slideShow"===type&&($scope["approvalStatus"+id]||(disabledHtml="myDisabled"))):"fleaMarket"==$scope.controllerName||"lostFound"==$scope.controllerName||"inforText"==$scope.controllerName?("approvalStatus"===type&&value&&(disabledHtml="myDisabled"),"dealStatus"===type&&(disabledHtml="myDisabled")):"maintenanceWorker"==$scope.controllerName||"teacher"==$scope.controllerName||"student"==$scope.controllerName?"approvalStatus"===type&&(value?disabledHtml="myDisabled":$scope["status"+id]||(disabledHtml="myDisabled")):"maintenanceEvaluation"==$scope.controllerName&&"approvalStatus"===type&&value&&(disabledHtml="myDisabled"),'<div class="mySwitch '+disabledHtml+'" ng-init="'+type+id+"="+value+'" ng-model="'+type+id+'" ng-click="changeStatusModal('+id+",'"+type+"',"+value+')"><div ng-class="'+type+id+"==1?'switchBody1 switchOpen1':'switchBody1 switchClose1'\"><div ng-class=\""+type+id+"==1?'switchBody2 switchOpen2':'switchBody2 switchClose2'\"><i ng-class=\""+type+id+"==1?'fa fa-check':'fa fa-times'\"></i></div></div></div>"},$rootScope.getWrapHtml=function(data,value,maxWidth){return'<div data-microtip="'+data+'" data-microtip-position="right"><div class="wrap-ellipsis" style="max-width:'+maxWidth+'px !important;">'+value+"</div></div>"},$rootScope.toLogin=function(){$rootScope.$state.go("login")},$rootScope.getUrlHtml=function(value,url){return'<a href="'+url+'" data-microtip="'+value+'" data-microtip-position="right" target="_blank">'+value+"</a>"},$rootScope.changeStatusModal=function(id,type,value){if($rootScope.changeStatusNowId=id,"slideShow"===type&&$scope.clearQueue(),"approvalStatus"===type||"slideShow"===type){if($("[ng-model="+type+id+"]").hasClass("myDisabled"))return}else if("dealStatus"===type)return;if($rootScope.changeStatusType=type,$rootScope.changeStatusId=id,"slideShow"===type)return $scope[type+id]?void 0:($rootScope.getScope("inforPicture").resultSaveId=id,void $("#pictureUpload").modal());if("homeShow"===type&&$rootScope.getScope("slide")){var slideCountScope=$rootScope.getScope("slide");slideCountScope.homeShowCount(value,function(){slideCountScope.countFlag&&$("#changeStatusModal").modal()})}else $("#changeStatusModal").modal()},$rootScope.resetForm=function($scope,$http,$compile,$location,$filter){var $formScope=$rootScope.getScope($scope.controllerName+"Add");$timeout(function(){$formScope.myForm.reset(),$scope.selectIdList&&angular.forEach($scope.selectIdList,function(value,key){var selectValid_=eval("$formScope.myForm."+value);selectValid_.$valid=!0})},0)},$rootScope.resetErrorInput=function($scope,$http,$compile,$location,$filter){$rootScope.getScope($scope.controllerName+"Add");$scope.resetInputList&&angular.forEach($scope.resetInputList,function(value){$scope.data[value]=""})},$rootScope.resetSearch=function($scope,$http,$compile,$location,$filter){var thisScope=$scope;thisScope.searchObj={},null!=thisScope.selectSearchIdList&&thisScope.triggerSelectSearch(thisScope,$http,$compile,$location,$filter)},$rootScope.resetDateTimePicker=function(){var ids=[].slice.call(arguments);angular.forEach(ids,function(id){$("#"+id).datetimepicker("setEndDate",null),$("#"+id).datetimepicker("setStartDate",null)})},$rootScope.uniqueList=function(list){for(var new_arr=[],i=0;i<list.length;i++){var items=list[i];-1==$.inArray(items,new_arr)&&new_arr.push(items)}return new_arr},$rootScope.focus=function(name,selectName){var $formScope=$rootScope.getScope(name+"Form");$timeout(function(){var select_=eval("$formScope.myForm."+selectName);select_.$viewValue||(select_.$valid=!1,$formScope.myForm.validateElement(selectName))},0)},$rootScope.triggerSelect=function($scope,$http,$compile,$location,$filter){$scope.selectIdList&&$scope.selectIdList.forEach(function(value){$timeout(function(){angular.element("[name="+value+"]").triggerHandler("change")},0)})},$rootScope.triggerSelectSearch=function($scope,$http,$compile,$location,$filter){$scope.selectSearchIdList&&$scope.selectSearchIdList.forEach(function(value){$timeout(function(){angular.element("[name="+value+"]").triggerHandler("change")},0)})},$rootScope.initPagination=function($scope){$scope.vm={},$scope.vm.pageSize=$scope.pageSize?$scope.pageSize:10,$scope.vm.maxSize=5,$scope.vm.totalItems=0,$scope.vm.currentPageItem=1,$scope.changePageSize=function(newValue){$scope.vm.currentPageItem=1,$scope.vm.pageSize=newValue<<0,$scope.getPaginationList()},$scope.getPaginationList=function(){$scope.params={pageSize:$scope.vm.pageSize,start:($scope.vm.currentPageItem-1)*$scope.vm.pageSize,pageNumber:$scope.vm.currentPageItem,order:{name:$scope.orderBy,dir:$scope.orderDir}},$http({url:$scope.httpDomain+$scope.url,method:"POST",data:$.extend($scope.params,$scope.myParams),headers:{"logistics-session-token":$scope.getToken()}}).success(function(data){$scope[$scope.requestListName]=data.data,$scope.vm.totalItems=data.total,$scope.vm.untilSize=Math.min($scope.vm.currentPageItem*$scope.vm.pageSize,$scope.vm.totalItems)})},$scope.changePagination=function(){$scope.getPaginationList()},$scope.getPaginationList()},$rootScope.checkValidateWithSensitive=function(thisEvent,model){var _val=thisEvent.target.value;_val&&allSensitiveName.forEach(function(value){if(_val.toLowerCase()==value.toLowerCase()){sweetAlert("警告","不允许输入敏感字符,请重新输入","warning");var splits=model.split("."),thisScope=angular.element($(thisEvent.target)).scope();$timeout(function(){thisScope.$apply(function(){thisScope[splits[0]][splits[1]]=""})},0)}})},$rootScope.getNextDayStr=function(todayStr,delta){var day=1;null!=delta&&(day=delta<<0);var second=new Date(todayStr).getTime(),add=864e5*day;return new Date(second+add).Format("yyyy-MM-dd")},$rootScope.getDutyInfo=function(_scope){$http({url:_scope.httpDomain+"getDutiesFromDepartmentTypeAndDate",method:"POST",data:{departmentId:_scope.departmentId,typeId:_scope.typeId,date:_scope.date},headers:{"logistics-session-token":_scope.getToken()}}).success(function(data,status,headers,config){if("SUCCESS"===data.status){var tableListData=[];angular.forEach(data.data,function(value){var obj={};obj.time=value.time+" ("+dateUtil.getWeekStr(value.time)+")",obj.dayPerson=value.dayPerson,obj.nightPerson=value.nightPerson,obj.holidayName=value.holidayName,tableListData.push(obj)}),_scope.tableListDataNew=tableListData}else sweetAlert("警告","查询失败,请重试!","error");_scope.removeLoading()}).error(function(data,status,headers,config){sweetAlert("警告","查询异常！","error"),_scope.removeLoading()})},$rootScope.exactMul=function(a1,a2){var m=0,s1=a1.toString(),s2=a2.toString();try{m+=s1.split(".")[1].length}catch(e){}try{m+=s2.split(".")[1].length}catch(e){}return Number(s1.replace(".",""))*Number(s2.replace(".",""))/Math.pow(10,m)},$rootScope.getScope=function(controllerName){var appElement=document.querySelector("[ng-controller="+controllerName+"Controller]");return angular.element(appElement).scope()},$rootScope.getLevelListFromDepartment=function(departmentScope){var departmentSelectDataAll=departmentScope.departmentSelectData,levelList=[];angular.forEach(departmentSelectDataAll,function(value){levelList.push({id:value.id,level:value.treeLevel})}),departmentScope.levelList=levelList},$rootScope.saveImage=function(data,filename,canvas){if(canvas.msToBlob){var blob=canvas.msToBlob();window.navigator.msSaveBlob(blob,filename+".png")}else{var save_link=document.createElementNS("http://www.w3.org/1999/xhtml","a");save_link.href=data,save_link.download=filename;var event=document.createEvent("MouseEvents");event.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),save_link.dispatchEvent(event)}},$rootScope.userLogin=function(){var homeUrl=portType+"://"+window.location.host+adminLogionSuffix;window.location=homeUrl},$scope.$on("$viewContentLoaded",function(){})}]),app.controller("HeaderController",["$scope","$http","$rootScope",function($scope,$http,$rootScope){$scope.$on("$includeContentLoaded",function(){Layout.initHeader()}),$scope.userSignOut=function(){$("#signoutModal").modal()},$scope.confirmSignOut=function(){$http({url:$scope.httpDomain+"cleanToken",method:"POST",data:{token:$rootScope.getToken()},headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data,status,headers,config){"SUCCESS"===data.status?(localStorage.setItem("com.logistics.user.token",null),localStorage.setItem("com.logistics.user.login",!1),localStorage.setItem("com.logistics.user.info",null),$scope.loginStatus=!1,$rootScope.userLogin()):sweetAlert("警告","注销失败请重试！","error")}).error(function(data,status,headers,config){sweetAlert("警告",$scope.repeatName+"校验异常！","error")})}}]),app.controller("SidebarController",["$state","$scope",function($state,$scope){$scope.$on("$includeContentLoaded",function(){Layout.initSidebar($state)})}]),app.controller("QuickSidebarController",["$scope",function($scope){$scope.$on("$includeContentLoaded",function(){setTimeout(function(){QuickSidebar.init()},2e3)})}]),app.controller("ThemePanelController",["$scope",function($scope){$scope.$on("$includeContentLoaded",function(){Demo.init()})}]),app.controller("FooterController",["$scope",function($scope){$scope.$on("$includeContentLoaded",function(){Layout.initFooter()})}]),app.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/dashboard.html"),$stateProvider.state("dashboard",{url:"/dashboard.html",templateUrl:"views/dashboard.html",data:{pageTitle:"首页"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/DashboardController.min.js"]})}]}}).state("materialCategory",{url:"/inventory/materialCategory",templateUrl:"views/inventoryManagement/materialCategory/list.html",data:{pageTitle:"物料类别"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/materialCategoryController.min.js"]})}]}}).state("materialUnit",{url:"/inventory/materialUnit",templateUrl:"views/inventoryManagement/materialUnit/list.html",data:{pageTitle:"物料单位"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/materialUnitController.min.js"]})}]}}).state("material",{url:"/inventory/material",templateUrl:"views/inventoryManagement/material/list.html",data:{pageTitle:"物料管理"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/materialController.min.js"]})}]}}).state("storage",{url:"/inventory/storage",templateUrl:"views/inventoryManagement/storage/list.html",data:{pageTitle:"入库管理"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/storageController.min.js"]})}]}}).state("stockRemoval",{url:"/inventory/stockRemoval",templateUrl:"views/inventoryManagement/stockRemoval/list.html",data:{pageTitle:"出库管理"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/stockRemovalController.min.js"]})}]}}).state("campus",{url:"/system/campus",templateUrl:"views/systemManagement/campus/list.html",data:{pageTitle:"校区管理"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/campusController.min.js"]})}]}}).state("department",{url:"/system/department",templateUrl:"views/systemManagement/department/list.html",data:{pageTitle:"部门管理"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/departmentController.min.js"]})}]}}).state("position",{url:"/system/position",templateUrl:"views/systemManagement/position/list.html",data:{pageTitle:"职务管理"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/positionController.min.js"]})}]}}).state("maintenanceType",{url:"/system/maintenanceType",templateUrl:"views/systemManagement/maintenanceType/list.html",data:{pageTitle:"维修工种"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/maintenanceTypeController.min.js"]})}]}}).state("maintenanceCategory",{url:"/system/maintenanceCategory",templateUrl:"views/systemManagement/maintenanceCategory/list.html",data:{pageTitle:"维修类别"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/maintenanceCategoryController.min.js"]})}]}}).state("maintenanceArea",{url:"/system/maintenanceArea",templateUrl:"views/systemManagement/maintenanceArea/list.html",data:{pageTitle:"维修区域"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/maintenanceAreaController.min.js"]})}]}}).state("maintenanceStatus",{url:"/system/maintenanceStatus",templateUrl:"views/systemManagement/maintenanceStatus/list.html",data:{pageTitle:"维修状态"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/maintenanceStatusController.min.js"]})}]}}).state("inforModule",{url:"/system/inforModule",templateUrl:"views/systemManagement/inforModule/list.html",data:{pageTitle:"信息模块"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/inforModuleController.min.js"]})}]}}).state("friendlyLink",{url:"/system/friendlyLink",templateUrl:"views/systemManagement/friendlyLink/list.html",data:{pageTitle:"友请链接"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/friendlyLinkController.min.js"]})}]}}).state("service",{url:"/system/service",templateUrl:"views/systemManagement/service/list.html",data:{pageTitle:"便民服务"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/serviceController.min.js"]})}]}}).state("teacher",{url:"/user/teacher",templateUrl:"views/userManagement/teacher/list.html",data:{pageTitle:"教职人员"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/teacherController.min.js"]})}]}}).state("maintenanceWorker",{url:"/user/maintenanceWorker",templateUrl:"views/userManagement/maintenanceWorker/list.html",data:{pageTitle:"维修人员"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/maintenanceWorkerController.min.js"]})}]}}).state("student",{url:"/user/student",templateUrl:"views/userManagement/student/list.html",data:{pageTitle:"注册学生"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/studentController.min.js"]})}]}}).state("userLoginLog",{url:"/user/userLoginLog",templateUrl:"views/userManagement/userLoginLog/list.html",data:{pageTitle:"用户登录日志"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/userLoginLogController.min.js"]})}]}}).state("inforPicture",{url:"/information/inforPicture",templateUrl:"views/informationManagement/inforPicture/list.html",data:{pageTitle:"模块信息"},params:{messageData:null},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load([{name:"angularFileUpload",files:["../dist/js/admin/controller/angular-file-upload.min.js"]},{name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/inforPictureController.min.js","../dist/js/admin/controller/slideUploadController.min.js"]}])}]}}).state("slide",{url:"/information/slide",templateUrl:"views/informationManagement/slide/list.html",data:{pageTitle:"幻灯管理"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load([{name:"angularFileUpload",files:["../dist/js/admin/controller/angular-file-upload.min.js"]},{name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/slideController.min.js","../dist/js/admin/controller/slideUploadController.min.js"]}])}]}}).state("inforText",{url:"/information/inforText",templateUrl:"views/informationManagement/inforText/list.html",data:{pageTitle:"建言献策"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/inforTextController.min.js"]})}]}}).state("fleaMarket",{url:"/information/fleaMarket",templateUrl:"views/informationManagement/fleaMarket/list.html",data:{pageTitle:"跳蚤市场"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/fleaMarketController.min.js"]})}]}}).state("lostFound",{url:"/information/lostFound",templateUrl:"views/informationManagement/lostFound/list.html",data:{pageTitle:"失物招领"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/lostFoundController.min.js"]})}]}}).state("workLog",{url:"/duty/workLog",templateUrl:"views/dutyManagement/workLog/list.html",data:{pageTitle:"工作日志"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/workLogController.min.js"]})}]}}).state("dutyRegister",{url:"/duty/register",templateUrl:"views/dutyManagement/duty/register.html",data:{pageTitle:"值班设置"},params:{messageData:null},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/dutyController.min.js"]})}]}}).state("duty",{url:"/duty/list",templateUrl:"views/dutyManagement/duty/list.html",data:{pageTitle:"值班管理"},params:{messageData:null},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/dutyController.min.js"]})}]}}).state("dutyShow",{url:"/duty/show",templateUrl:"views/dutyManagement/duty/dutyShowList.html",data:{pageTitle:"值班表"},params:{id:null},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/dutyController.min.js"]})}]}}).state("maintenanceRecords",{url:"/maintenance/maintenanceRecords",templateUrl:"views/maintenanceManagement/maintenanceRecords/list.html",data:{pageTitle:"维修管理"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/maintenanceRecordsController.min.js"]})}]}}).state("specialMaintenance",{url:"/maintenance/specialMaintenance",templateUrl:"views/maintenanceManagement/specialMaintenance/list.html",data:{pageTitle:"专项管理"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/specialMaintenanceController.min.js"]})}]}}).state("maintenanceEvaluation",{url:"/maintenance/maintenanceEvaluation",templateUrl:"views/maintenanceManagement/maintenanceEvaluation/list.html",data:{pageTitle:"维修评价"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/admin/controller/maintenanceEvaluationController.min.js"]})}]}})}]),app.run(["$rootScope","settings","$state",function($rootScope,settings,$state){$rootScope.$state=$state,$rootScope.$settings=settings}]);
angular.module("MetronicApp").directive("ngSpinnerBar",["$rootScope","$state",function($rootScope,$state){return{link:function(scope,element,attrs){element.addClass("hide"),$rootScope.$on("$stateChangeStart",function(){element.removeClass("hide")}),$rootScope.$on("$stateChangeSuccess",function(){element.addClass("hide"),$("body").removeClass("page-on-load"),Layout.setAngularJsSidebarMenuActiveLink("match",null,$state),setTimeout(function(){App.scrollTop()},$rootScope.settings.layout.pageAutoScrollOnLoad)}),$rootScope.$on("$stateNotFound",function(){element.addClass("hide")}),$rootScope.$on("$stateChangeError",function(){element.addClass("hide")})}}}]),angular.module("MetronicApp").directive("a",function(){return{restrict:"E",link:function(scope,elem,attrs){(attrs.ngClick||""===attrs.href||"#"===attrs.href)&&elem.on("click",function(e){e.preventDefault()})}}}),angular.module("MetronicApp").directive("dropdownMenuHover",function(){return{link:function(scope,elem){elem.dropdownHover()}}});
function GeneralPageController($rootScope,$scope,settings){$scope.$on("$viewContentLoaded",function(){App.initAjax(),$rootScope.settings.layout.pageContentWhite=!0,$rootScope.settings.layout.pageBodySolid=!1,$rootScope.settings.layout.pageSidebarClosed=!1})}angular.module("MetronicApp").controller("GeneralPageController",GeneralPageController);
function getStatusTypeData($scope,$http,$compile,$location,$filter){$scope.statusTypeData=[{id:1,name:"显示",value:"1"},{id:2,name:"隐藏",value:"0"}]}function getStatusUseTypeData($scope,$http,$compile,$location,$filter){$scope.statusUseTypeData=[{id:1,name:"启用",value:"1"},{id:2,name:"禁用",value:"0"}]}function getSexTypeData($scope,$http,$compile,$location,$filter){$scope.sexTypeData=[{id:1,name:"男",value:"1"},{id:2,name:"女",value:"0"}]}function getPositionStatusData($scope,$http,$compile,$location,$filter){$scope.positionStatusData=[{id:1,name:"在职",value:"1"},{id:2,name:"离职",value:"0"}]}function getStudentStatusData($scope,$http,$compile,$location,$filter){$scope.studentStatusData=[{id:1,name:"在校",value:"1"},{id:2,name:"离校",value:"0"}]}function getLostFoundStatusData($scope,$http,$compile,$location,$filter){$scope.lostFoundStatusData=[{id:1,name:"失物",value:"1"},{id:2,name:"招领",value:"0"}]}function getFleaMarketStatusData($scope,$http,$compile,$location,$filter){$scope.fleaMarketStatusData=[{id:1,name:"出售",value:"1"},{id:2,name:"求购",value:"0"}]}function getApprovalStatusData($scope,$http,$compile,$location,$filter){return $scope.approvalStatusData=[{id:1,name:"通过审核",value:"1"},{id:2,name:"未通过审核",value:"0"}]}function getShowStatusData($scope,$http,$compile,$location,$filter){$scope.showStatusData=[{id:1,name:"是",value:"1"},{id:2,name:"否",value:"0"}]}function getInforTypesData($scope,$http,$compile,$location,$filter){$scope.inforTypeData=[{id:1,name:"文本类型",value:"0"},{id:2,name:"图文类型",value:"1"}]}function getCampusSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getCampusSelectList",$scope.selectOptName="获取校区信息",$scope.selectPara="campusSelectData",$scope.getSelectInfoApi($scope);$scope.campusSelectData=[{name:"校区1",id:1},{name:"校区2",id:2},{name:"校区3",id:3},{name:"校区4",id:4}]}function getDepartmentSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getDepartmentSelectList",$scope.selectOptName="获取部门信息",$scope.selectPara="departmentSelectData",$scope.getSelectInfoApi($scope);$scope.departmentSelectData=[{name:"部门1",id:0},{name:"部门2",id:1},{name:"部门3",id:2},{name:"部门4",id:3}]}function getMaintenanceTypeSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaintenanceTypeSelectList",$scope.selectOptName="获取维修工种信息",$scope.selectPara="maintenanceTypeSelectData",$scope.getSelectInfoApi($scope);$scope.maintenanceTypeSelectData=[{name:"水",id:12},{name:"电",id:23},{name:"木",id:34}]}function getWorkerSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaintenanceWorkerSelectList",$scope.selectOptName="获取维修人员信息",$scope.selectPara="workerSelectData",$scope.getSelectInfoApi($scope);$scope.workerSelectData=[{name:"张三",id:1,maintenanceType:{name:"水",id:1}},{name:"李四",id:2,maintenanceType:{name:"水",id:1}},{name:"王五",id:3,maintenanceType:{name:"电",id:2}}]}function getPositionSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getPositionSelectList",$scope.selectOptName="获取职务信息",$scope.selectPara="positionSelectData",$scope.getSelectInfoApi($scope);$scope.positionSelectData=[{name:"校长",id:1},{name:"院长",id:2},{name:"系主任",id:3},{name:"部长",id:4}]}function getMaterialUnitSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaterialUnitSelectList",$scope.selectOptName="获取物料单位信息",$scope.selectPara="materialUnitSelectData",$scope.getSelectInfoApi($scope);$scope.materialUnitSelectData=[{name:"物料单位1",id:1},{name:"物料单位2",id:2},{name:"物料单位3",id:3},{name:"物料单位4",id:4}]}function getMaterialCategorySelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaterialCategorySelectList",$scope.selectOptName="获取物料类别信息",$scope.selectPara="materialCategorySelectData",$scope.getSelectInfoApi($scope);$scope.materialCategorySelectData=[{name:"物料类别1",id:1},{name:"物料类别2",id:2},{name:"物料类别3",id:3},{name:"物料类别4",id:4},{name:"物料类别5",id:5}]}function getMaterialSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaterialSelectList",$scope.selectOptName="获取物料信息",$scope.selectPara="materialSelectData",$scope.getSelectInfoApi($scope);$scope.materialSelectData=[{name:"物料1",id:1},{name:"物料2",id:2},{name:"物料3",id:3},{name:"物料4",id:4}]}function getWarrantyNumberSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getWarrantyNumberSelectList",$scope.selectOptName="获取维修单号信息",$scope.selectPara="warrantyNumberSelectData",$scope.getSelectInfoApi($scope);$scope.warrantyNumberSelectData=[{maintenanceNumber:"维修单号1",id:1},{maintenanceNumber:"维修单号2",id:2},{maintenanceNumber:"维修单号3",id:3},{maintenanceNumber:"维修单号4",id:4}]}function getWarrantyNumberIsDoneSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getWarrantyNumberSelectListForStockRemoval",$scope.selectOptName="获取维修单号信息",$scope.selectPara="warrantyNumberSelectData",$scope.getSelectInfoApi($scope);$scope.warrantyNumberSelectData=[{maintenanceNumber:"维修单号1",id:1},{maintenanceNumber:"维修单号2",id:2},{maintenanceNumber:"维修单号3",id:3},{maintenanceNumber:"维修单号4",id:4}]}function getInforModuleSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getInforModuleSelectList",$scope.selectOptName="获取模块信息信息",$scope.selectPara="inforModulelSelectData",$scope.getSelectInfoApi($scope);$scope.inforModulelSelectData=[{name:"模块名称1",id:7},{name:"模块名称2",id:8},{name:"模块名称3",id:9},{name:"模块名称4",id:10}]}function getFinishedSelectData($scope,$http,$compile,$location,$filter){$scope.finishedlSelectData=[{name:"已完成",id:1},{name:"未完成",id:2}]}function getMaintenanceAreaData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaintenanceAreaSelectList",$scope.selectOptName="获取维修区域信息",$scope.selectPara="maintenanceAreaData",$scope.getSelectInfoApi($scope);$scope.maintenanceAreaData=[{name:"维修区域1",id:1},{name:"维修区域2",id:2},{name:"维修区域3",id:3},{name:"维修区域4",id:4}]}function getDutyTimeData($scope,$http,$compile,$location,$filter){$scope.dutyTimeData=[{name:"全天",id:1,value:"0"},{name:"白班",id:2,value:"1"},{name:"夜班",id:3,value:"2"}]}function getMaintenanceNumber(){return(new Date).Format("yyyyMMdd")+"XXXX"}function getRepairStatusData($scope,$http,$compile,$location,$filter){$scope.repairStatusData=[{name:"好评",id:1,value:"1"},{name:"中评",id:2,value:"2"},{name:"差评",id:0,value:"0"}]}function getMaintenanceStatusData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getAllMaintenanceStatus",$scope.selectOptName="获取维修状态信息",$scope.selectPara="maintenanceStatusData",$scope.getSelectInfoApi($scope);$scope.maintenanceAreaData=[{name:"待审核",id:1},{name:"待受理",id:2},{name:"待派工",id:3},{name:"待完工",id:4},{name:"维修中",id:5},{name:"已完工",id:6},{name:"已回访",id:7},{name:"已维修",id:8},{name:"未验收",id:9},{name:"锁定",id:10}]}function subDateStr(dateStr){return dateStr.substring(0,10)}function subHourStr(dateStr){return dateStr.substring(10,16)}function priceConfig(){$("#price").TouchSpin({min:0,max:1e4,step:1,decimals:0,postfix:"¥"}),$("#price2").TouchSpin({min:0,max:1e4,step:.01,decimals:2,postfix:"¥"})}function getRegisterTypesData($scope,$http,$compile,$location,$filter){$scope.registerTypesData=[{name:"教值人员",value:2},{name:"在校学生",value:3},{name:"维修工人",value:1}]}
var dataTables=function(){var initTable=function($scope,$http,$compile,$location,$filter){var table;(table=$scope.initDataTablesName?$("#"+$scope.initDataTablesName):$("#dataTable")).dataTable($.extend({language:{aria:{sortAscending:": 以升序排列此列",sortDescending:": 以降序排列此列"},emptyTable:"没有查询出数据",info:"显示 _START_ 至 _END_ 项结果 , 总共 _TOTAL_ 条数据",infoEmpty:"",infoFiltered:"(由 _MAX_ 项结果过滤)",lengthMenu:"选择分页 : _MENU_",search:"查询 :",zeroRecords:"没有匹配结果",paginate:{previous:"上一页",next:"下一页",last:"末页",first:"首页"}},serverSide:!0,ajax:function(data,callback,settings){$scope.addLoading();try{var param={};param.pageSize=data.length,param.start=data.start,param.pageNumber=data.start/data.length+1,param.order={};var orderObj=data.order[0];param.order.dir=orderObj.dir,param.order.name=data.columns[orderObj.column].data,param.searchObj=void 0==$scope.searchObj?"":$scope.searchObj,$.ajax({type:"POST",url:void 0!=$scope.url&&$scope.ifOpenApi?$scope.httpDomain+$scope.url:"demo/"+$scope.controllerName+".json",cache:!1,data:param,dataType:"json",headers:{"logistics-session-token":$scope.getToken()},success:function(result){var returnData={};returnData.draw=data.draw,returnData.data=result.data,returnData.recordsTotal=result.total,returnData.recordsFiltered=returnData.recordsTotal,returnData.data&&callback(returnData),$scope.removeLoading()},error:function(){$scope.removeLoading()}})}catch(e){$scope.removeLoading()}},columns:$scope.columns,bLengthChange:!1,bPaginate:!0,bStateSave:!1,searching:!1,lengthMenu:[[10,20,-1],[10,20,"全部"]],pageLength:10,pagingType:"bootstrap_full_number",columnDefs:[{orderable:!1,targets:$scope.orderableAry},{targets:$scope.trueOrFalse,data:null,render:function(data){return"1"==data?"是":"否"}},{targets:$scope.htmlType,data:null,render:function(data){return $("<span/>").text(data).html()}},{targets:$scope.inforType,data:null,render:function(data){return"1"==data?"图文类型":"文本类型"}},{targets:$scope.sexType,data:null,render:function(data){return"1"==data?"男":"女"}},{targets:$scope.ifDoneType,data:null,render:function(data){return"1"==data?"已完成":"未完成"}},{targets:$scope.repairType,data:null,render:function(data){return"1"==data?"微信报修":"网页报修"}},{targets:$scope.dateFormatAry,data:null,render:function(data){return subDateStr(data)}},{targets:$scope.dateFormatMonthDay,data:null,render:function(data){return subDateStr(data)}},{targets:$scope.dateFormatHourDay,data:null,render:function(data){return subHourStr(data)}},{targets:$scope.fleaMarketType,data:null,render:function(data){return"1"==data?"出售":"求购"}},{targets:$scope.lostFoundType,data:null,render:function(data){return"1"==data?"失物":"招领"}},{targets:$scope.nullStr,data:null,render:function(data){return null==data?"":data}},{targets:$scope.wrapLongAry,data:null,render:function(data){return $scope.getWrapHtml(data,data,"400")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.wrapAry,data:null,render:function(data){return $scope.getWrapHtml(data,data,"200")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.wrapShortAry,data:null,render:function(data){return null==data||void 0==data?"":$scope.getWrapHtml(data,data,"100")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.urlAry,data:null,render:function(data){return $scope.getUrlHtml(data,data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.dealStatus,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"dealStatus",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.switchStatus,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"status",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.cardDisplay,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"cardDisplay",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.switchSlideShow,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"slideShow",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.switchHomeShow,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"homeShow",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.switchWorkStatus,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"workStatus",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.approvalStatus,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"approvalStatus",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.targetsOpt,data:null,render:function(data,dispaly,row){var params=JSON.stringify(data).replace(/\'/g,"&apos;"),editName=void 0==$scope.editName?"修改":$scope.editName,detailOptHtml="<a data-microtip='详情' data-microtip-position='top' class='btn btn-xs green-haze showDetailOpt' data-toggle='modal'><i class='fa fa-file-o'></i></a>",editOptHtml="<a data-microtip='修改' data-microtip-position='top' ng-click='editModal("+params+")' class='btn btn-xs blue' data-toggle='modal'><i class='fa fa-edit'></i></a>",editNewPageOptHtml="<a data-microtip="+editName+" data-microtip-position='top' ng-click='editNewPage("+params+")' class='btn btn-xs blue' data-toggle='modal'><i class='fa fa-edit'></i></a>",removeOptHtml="<a data-microtip='删除' data-microtip-position='top' ng-click='removeModal("+data.id+")' class='btn btn-xs red' data-toggle='modal'><i class='fa fa-times'></i></a>",previewOptHtml="<a data-microtip='预览' data-microtip-position='top' ng-click='preview("+data.id+")' class='btn btn-xs purple-sharp' data-toggle='modal'><i class='fa fa-link'></i></a>",replyFlag=!1,replyStr="回复";null!=data.reply&&""!=data.reply&&(replyFlag=!0,replyStr="已回复");var replyOptHtml="<a ng-disabled='"+replyFlag+"' data-microtip='"+replyStr+"' data-microtip-position='top' ng-click='replyModal("+data.id+","+replyFlag+")' class='btn btn-xs purple-sharp' data-toggle='modal'><i class='fa fa-reply'></i></a>",assignedFlag="disabled",assignedStr="手动指派";try{data.maintenanceRecord.maintenanceStatus.weight&&2==data.maintenanceRecord.maintenanceStatus.weight&&(assignedFlag="")}catch(e){assignedFlag="disabled"}var assignedOptHtml="<a "+assignedFlag+" data-microtip='"+assignedStr+"' data-microtip-position='top' ng-click='assignedModal("+data.id+', "'+assignedFlag+"\")' class='btn btn-xs purple-sharp' data-toggle='modal'><i class='fa fa-hand-pointer-o'></i></a>",printFlag="true",printView="disabled";try{!data.maintenanceRecord.maintenanceStatus.weight||6!=data.maintenanceRecord.maintenanceStatus.weight&&7!=data.maintenanceRecord.maintenanceStatus.weight&&8!=data.maintenanceRecord.maintenanceStatus.weight||(printFlag="false",printView="")}catch(e){printFlag="true",printView="disabled"}var printOptHtml="<a "+printView+" data-microtip='打印预览' data-microtip-position='top' ng-click='maintenancePrint("+data.id+", "+printFlag+")' class='btn btn-xs yellow' data-toggle='modal'><i class='fa fa-print'></i></a>",imgViewOptHtml="<a data-microtip='图片预览' data-microtip-position='top' href='"+data.slidePicture+"' class='btn btn-xs yellow' data-toggle='modal' target='_blank'><i class='fa fa-photo'></i></a>",urlViewOptHtml=""===data.url?"<a data-microtip='幻灯链接' data-microtip-position='top' ng-disabled=true class='btn btn-xs purple-sharp' data-toggle='modal' target='_blank'><i class='fa fa-link'></i></a>":"<a data-microtip='幻灯链接' data-microtip-position='top' href='"+data.url+"' class='btn btn-xs purple-sharp' data-toggle='modal' target='_blank'><i class='fa fa-link'></i></a>",resetPswOptHtml="<a data-microtip='重置密码' data-microtip-position='top' ng-click='resetPswModal("+data.id+")' class='btn btn-xs yellow' data-toggle='modal'><i class='fa fa-lock'></i></a>",campusName="";data.campus&&(campusName=data.campus.name);var dutyOptHtml="<a data-microtip='值班设置' data-microtip-position='top' ng-click='dutySite("+data.id+',"'+data.name+'","'+campusName+"\")' class='btn btn-xs blue' data-toggle='modal'><i class='icon-settings'></i></a>",dutyShowOptHtml="<a data-microtip='已设置查询' data-microtip-position='top' ng-click='dutyShowView("+data.id+',"'+data.name+"\")' class='btn btn-xs yellow-gold' data-toggle='modal'><i class='fa fa-file-o'></i></a>",html="";return angular.forEach($scope.optHtmlAry,function(value,key){html+=eval(value+"OptHtml")}),html},fnCreatedCell:function(nTd){$compile(nTd)($scope)}}],responsive:{details:{type:"column",target:"td>.showDetailOpt"}},destroy:!0,order:$scope.order,fnDrawCallback:function(){this.api().column(0).nodes().each(function(cell,i){cell.innerHTML=i+1}),$(".make-switch").bootstrapSwitch()}},$scope.scroll))};return{init:function($scope,$http,$compile,$location,$filter){jQuery().dataTable&&initTable($scope,$http,$compile,$location,$filter)}}}();
var datePickers=function(){var initDatePicker=function($scope,$http,$compile,$location,$filter){var commonOptions={autoclose:!0,isRTL:App.isRTL(),pickerPosition:App.isRTL()?"bottom-right":"bottom-left",todayBtn:!0,language:"zh-CN",todayHighlight:!0},option=$.extend(commonOptions,$scope.option);$(".form_datetime").datetimepicker(option),$("body").removeClass("modal-open")},initFormDatePicker=function($scope,$http,$compile,$location,$filter){var commonOptions={autoclose:!0,isRTL:App.isRTL(),pickerPosition:App.isRTL()?"bottom-right":"bottom-left",todayBtn:!0,language:"zh-CN",todayHighlight:!0},option=$.extend(commonOptions,$scope.option);angular.forEach($scope.datetimepickerId,function(id){$("#"+id+"StartDateTime").datetimepicker(option).on("changeDate",function(ev){$("#"+id+"EndDateTime").datetimepicker("setStartDate",$scope.data[id+"StartDateTime"]),$("#"+id+"StartDateTime").datetimepicker("hide")}),$("#"+id+"EndDateTime").datetimepicker(option).on("changeDate",function(ev){$("#"+id+"StartDateTime").datetimepicker("setEndDate",$scope.data[id+"EndDateTime"]),$("#"+id+"EndDateTime").datetimepicker("hide")})}),$("body").removeClass("modal-open")},initSearchDatePicker=function($scope,$http,$compile,$location,$filter){var option={isRTL:App.isRTL(),pickerPosition:App.isRTL()?"bottom-right":"bottom-left",format:"yyyy-mm-dd",todayHighlight:!0,language:"zh-CN",autoclose:!0,minView:2};angular.forEach($scope.datetimepickerId,function(id){$("#"+id+"Start").datetimepicker(option).on("changeDate",function(ev){$("#"+id+"End").datetimepicker("setStartDate",$scope.searchObj[id+"Start"]),$("#"+id+"Start").datetimepicker("hide")}),$("#"+id+"End").datetimepicker(option).on("changeDate",function(ev){$("#"+id+"Start").datetimepicker("setEndDate",$scope.searchObj[id+"End"]),$("#"+id+"End").datetimepicker("hide")})}),$("body").removeClass("modal-open")};return{init:function($scope,$http,$compile,$location,$filter){1==$scope.searchInit?initSearchDatePicker($scope):1==$scope.formInit?initFormDatePicker($scope):initDatePicker($scope)}}}(),timePickers=function(){var initTimePicker=function($scope,$http,$compile,$location,$filter){var commonOptions={autoclose:!0,showSeconds:!0,minuteStep:1,defaultTime:!1,format:"HH:mm:ss"},option=$.extend(commonOptions,$scope.option);$(".timepicker").timepicker(option),$("body").removeClass("model-open")},initFormTimePicker=function($scope,$http,$compile,$location,$filter){var commonOptions={format:"HH:mm:ss",trigger:"manual"},option=$.extend(commonOptions,$scope.option);angular.forEach($scope.timepickerId,function(id){$("#"+id+"Start").timepicker(option).on("changeDate",function(ev){$("#"+id+"End").timepicker("setStartDate",$scope.searchObj[id+"Start"]),$("#"+id+"Start").timepicker("hide")}),$("#"+id+"End").timepicker(option).on("changeDate",function(ev){$("#"+id+"Start").timepicker("setEndDate",$scope.searchObj[id+"End"]),$("#"+id+"End").timepicker("hide")})}),$("body").removeClass("modal-open")};return{init:function($scope,$http,$compile,$location,$filter){1==$scope.formInitTime?initFormTimePicker($scope):initTimePicker($scope)}}}();
function getTrees($scope,$http,$compile,$location,$filter){$("#"+$scope.controllerName+"Tree").jstree({core:{data:null}}),trees.init($scope,$http,$compile,$location,$filter)}var trees=function(){var initTree=function($scope,$http,$compile,$location,$filter){var _url;_url=$scope.ifOpenApi?$scope.httpDomain+$scope.treeUrl:"../admin/demo/"+$scope.controllerName+"Tree.json",$.ajax({type:"POST",url:_url,dataType:"json",success:function(data){var tree=$("#"+$scope.controllerName+"Tree").jstree(!0);tree.settings={plugins:["types"],types:{default:{icon:"fa fa-folder icon-state-warning icon-lg"}},core:{themes:{responsive:!1},data:data}},tree.refresh()}})};return{init:function($scope,$http,$compile,$location,$filter){initTree($scope)}}}();
var editors=function(){var handleSummernote=function($scope){function sendFile(files,editor,$editable){$scope.addLoading();var data=new FormData;data.append("ajaxTaskFile",files[0]),$.ajax({data:data,type:"POST",url:$scope.httpDomain+$scope.uploadUrl,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(data){"SUCCESS"===data.message?($("#summernote").summernote("insertImage",data.url),sweetAlert("提示","图片添加成功！","success")):sweetAlert("警告","图片添加失败！","error"),$scope.removeLoading()},error:function(){sweetAlert("警告","图片添加失败！","error"),$scope.removeLoading()}})}$("#summernote").summernote({height:400,lang:"zh-CN",focus:!0,toolbar:[["style",["style"]],["font",["bold","underline","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link","picture"]]],callbacks:{onImageUpload:function(files,editor,$editable){sendFile(files)}}})};return{init:function($scope){handleSummernote($scope)}}}();
function getWeek(dateString){var date;if(isNull(dateString))date=new Date;else{var dateArray=dateString.split("-");date=new Date(dateArray[0],parseInt(dateArray[1]-1),dateArray[2])}return"周"+"日一二三四五六".charAt(date.getDay())}Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in o)new RegExp("("+k+")").test(fmt)&&(fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return fmt},$(function(){setInterval(function(){var year=(date=new Date).getFullYear(),month=date.getMonth()+1,day=date.getDate(),hours=date.getHours(),minutes=date.getMinutes(),seconds=date.getSeconds(),date=date.getDate(),t=year+"年"+month+"月"+day+"日 "+(hours=hours>=10?hours:"0"+hours)+":"+(minutes=minutes>=10?minutes:"0"+minutes)+":"+(seconds=seconds>=10?seconds:"0"+seconds);$("#clock").html(t)},1e3)});var dateUtil=function(){function isNull(object){return null==object||void 0===object}return{getWeekStr:function(dateString){var date;if(isNull(dateString))date=new Date;else{var dateArray=dateString.split("-");date=new Date(dateArray[0],parseInt(dateArray[1]-1),dateArray[2])}return"周"+"日一二三四五六".charAt(date.getDay())}}}();
var calendar=function(){var initCalendar=function(){var date=new Date;date.getDate(),date.getMonth(),date.getFullYear();$("#calendar").fullCalendar({lang:"zh-cn",header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},weekends:!0,events:function(start,end,timezone,callback){var date=this.getDate().format("YYYY-MM");$.ajax({url:"demo/duty.json",dataType:"json",data:{date:date},success:function(json){var events=[];$.each(json.data,function(i,c){events.push({title:c.title,start:c.start,end:c.end,color:c.color,id:c.id})}),callback(events)}})},dayClick:function(date,jsEvent,view){$("#calendar").fullCalendar("clientEvents",function(event){var eventStart=event.start.format("YYYY-MM-DD"),eventEnd=event.end?event.end.format("YYYY-MM-DD"):null,theDate=date.format("YYYY-MM-DD");return eventStart<=theDate&&eventEnd>=theDate&&!(eventStart<theDate&&eventEnd==theDate)||eventStart==theDate&&null===eventEnd})}})},initRegisterCalendar=function(scope){$("#calendar").fullCalendar({lang:"zh-cn",header:{left:"prev,next",center:"title",right:"today"},view:function(){return{start:$.fullCalendar.moment((new Date).Format("yyyy")+"-01-01T00:00:00"),end:$.fullCalendar.moment((new Date).Format("yyyy")+"-12-31T00:00:00")}},weekends:!0,selectable:!0,unselectAuto:!1,events:function(start,end,timezone,callback){var _year=new Date(this.getDate()).Format("yyyy"),_month=new Date(this.getDate()).Format("MM"),thisYear=(new Date).Format("yyyy");if(_year===thisYear){var checkedDateList=localStorage.getItem("com.logistics.duty.checkedDateList"),checkedYearMonth=localStorage.getItem("com.logistics.duty.checkedYearMonth");checkedYearMonth&&"null"!==checkedYearMonth&&("true"==localStorage.getItem("com.logistics.duty.callbackToFirst")?(this.gotoDate(new Date(checkedYearMonth+"-01")),localStorage.setItem("com.logistics.duty.callbackToFirst",!1)):(localStorage.removeItem("com.logistics.duty.checkedDateList"),localStorage.removeItem("com.logistics.duty.checkedYearMonth"),_year+"-"+_month!==checkedYearMonth?checkedDateList=null:(_year=checkedYearMonth.substring(0,4),_month=checkedYearMonth.substring(5,7)))),scope.addLoading(),$.ajax({url:scope.httpDomain+scope.url,dataType:"json",type:"POST",data:{year:_year,month:_month},headers:{"logistics-session-token":scope.getToken()},success:function(json){$("td.fc-day").addClass("calendarTableDone"),scope.holidayDate=json.data,localStorage.setItem("com.logistics.duty.AllHolidayFromDate",JSON.stringify(scope.holidayDate));var events=[];if($.each(json.data,function(i,c){events.push({title:c.title,start:c.start,end:c.end,backgroundColor:"2"==c.type?"#E7505A":"#36D7B7"}),null!==checkedDateList&&"null"!==checkedDateList||initFalseDateAndIcon(c.start,!1)}),checkedDateList&&"null"!==checkedDateList){var allDays=getDaysInMonth(_year,_month);checkedDateList.split(",").forEach(function(date){allDays.splice($.inArray(date,allDays),1)}),allDays.forEach(function(date){initFalseDateAndIcon(date,!1)})}callback(events),changeDisableTbClass(),getCheckedDate(scope),$("td.fc-day.calendarTableDone:not(.calendarTableDisabled,.calendarTableFalse)").append(trueImgStr),scope.removeLoading()},error:function(){scope.removeLoading(),sweetAlert("警告","获取失败,请重试!","error")}})}else _year>>0>thisYear>>0?this.gotoDate(new Date(thisYear+"-12-01")):this.gotoDate(new Date(thisYear+"-01-01"))},dayClick:function(date,jsEvent,view){thisDayClickEvent($(this),scope);$("#calendar").fullCalendar("clientEvents",function(event){var eventStart=event.start.format("YYYY-MM-DD"),eventEnd=event.end?event.end.format("YYYY-MM-DD"):null,theDate=date.format("YYYY-MM-DD");return eventStart<=theDate&&eventEnd>=theDate&&!(eventStart<theDate&&eventEnd==theDate)||eventStart==theDate&&null===eventEnd})},eventClick:function(event,jsEvent,view){var time=event.start._i,_thisDay=$('td[data-date="'+time+'"].fc-widget-content');thisDayClickEvent($(_thisDay),scope)}})},initAutoDuty=function(){$("#calendar").fullCalendar({lang:"zh-cn",header:{left:"",center:"title",right:""},weekends:!0,eventOrder:["-backgroundColor","-color"],events:function(start,end,timezone,callback){var checkedYearMonth=localStorage.getItem("com.logistics.duty.checkedYearMonth");checkedYearMonth&&"null"!==checkedYearMonth&&this.gotoDate(new Date(checkedYearMonth+"-01").Format("yyyy-MM"));var _year=checkedYearMonth.substring(0,4),_month=checkedYearMonth.substring(5,7),checkedDateList=localStorage.getItem("com.logistics.duty.checkedDateList");if($("td.fc-day").addClass("calendarTableDone"),checkedDateList&&"null"!==checkedDateList){var allDays=getDaysInMonth(_year,_month);checkedDateList.split(",").forEach(function(date){allDays.splice($.inArray(date,allDays),1)}),allDays.forEach(function(date){initFalseDateAndIcon(date,!0)})}$("td.fc-day-number.fc-today.fc-state-highlight").removeClass().addClass("calendarTodayBar"),checkedDateList&&"null"!==checkedDateList&&$("td.fc-day.fc-today").removeClass("fc-today"),changeDisableTbClass()}})},initManualDuty=function(scope){$("#calendar").fullCalendar({lang:"zh-cn",header:{left:"",center:"title",right:""},weekends:!0,eventOrder:["-backgroundColor","-color"],editable:!0,eventStartEditable:!0,eventDurationEditable:!1,dragOpacity:{agenda:.5,"":.6},eventDrop:function(event,delta,revertFunc,jsEvent,ui,view){localStorage.getItem("com.logistics.duty.checkedDateList"),eventDropAllow(scope,event,delta)?scope.select.isSelected&&moveOriginalEventToStartDate(scope):revertFunc()},events:function(start,end,timezone,callback){var checkedYearMonth=localStorage.getItem("com.logistics.duty.checkedYearMonth");checkedYearMonth&&"null"!==checkedYearMonth&&this.gotoDate(new Date(checkedYearMonth+"-01").Format("yyyy-MM"));var _year=checkedYearMonth.substring(0,4),_month=checkedYearMonth.substring(5,7),checkedDateList=localStorage.getItem("com.logistics.duty.checkedDateList");if($("td.fc-day").addClass("calendarTableDone"),checkedDateList&&"null"!==checkedDateList){var allDays=getDaysInMonth(_year,_month);checkedDateList.split(",").forEach(function(date){allDays.splice($.inArray(date,allDays),1)}),allDays.forEach(function(date){initFalseDateAndIcon(date,!0)})}$("td.fc-day-number.fc-today.fc-state-highlight").removeClass().addClass("calendarTodayBar"),checkedDateList&&"null"!==checkedDateList&&$("td.fc-day.fc-today").removeClass("fc-today"),changeDisableTbClass(),callback(scope.events)}})},initLastDuty=function(scope){$("#calendar").fullCalendar({lang:"zh-cn",header:{left:"",center:"title",right:""},weekends:!0,eventOrder:["-backgroundColor","-color"],events:function(start,end,timezone,callback){var checkedYearMonth=localStorage.getItem("com.logistics.duty.checkedYearMonth");checkedYearMonth&&"null"!==checkedYearMonth&&this.gotoDate(new Date(checkedYearMonth+"-01").Format("yyyy-MM"));var _year=checkedYearMonth.substring(0,4),_month=checkedYearMonth.substring(5,7),checkedDateList=localStorage.getItem("com.logistics.duty.checkedDateList");if($("td.fc-day").addClass("calendarTableDone"),checkedDateList&&"null"!==checkedDateList){var allDays=getDaysInMonth(_year,_month);checkedDateList.split(",").forEach(function(date){allDays.splice($.inArray(date,allDays),1)}),allDays.forEach(function(date){initFalseDateAndIcon(date,!0)})}$("td.fc-day-number.fc-today.fc-state-highlight").removeClass().addClass("calendarTodayBar"),checkedDateList&&"null"!==checkedDateList&&$("td.fc-day.fc-today").removeClass("fc-today"),changeDisableTbClass(),callback(scope.events)}})},changeDisableTbClass=function(){$("td.fc-other-month").addClass("calendarTableDisabled").children("img").remove()},getCheckedDate=function(scope){var checkedDate=[];$("td.fc-day.calendarTableDone:not(.calendarTableDisabled,.calendarTableFalse)").each(function(){checkedDate.push($(this).attr("data-date"))}),scope.$apply(function(){scope.checkedDayList=checkedDate})},initFalseDateAndIcon=function(date,flag){var _td=$('td[data-date="'+date+'"].calendarTableDone');_td.addClass("calendarTableFalse"),_td.remove("img"),flag||(_td.append(falseImgStr),_td.hasClass("fc-today")&&_td.removeClass("fc-today"))},getDaysInMonth=function(year,month){for(var allDay=new Date(year,month,0).getDate(),returnDateList=[],i=1;i<=allDay;i++)returnDateList.push(new Date(year,month-1,i).Format("yyyy-MM-dd"));return returnDateList},thisDayClickEvent=function(_this,scope){_this.hasClass("calendarTableFalse")?(_this.removeClass("calendarTableFalse"),_this.children("img.calendarTipImg").remove(),_this.append(trueImgStr),getCheckedDate(scope)):_this.hasClass("calendarTableDisabled")||(_this.hasClass("fc-today")?_this.removeClass("fc-today").addClass("calendarTableFalse"):_this.addClass("calendarTableFalse"),_this.append(falseImgStr),getCheckedDate(scope))},eventDropAllow=function(scope,event,delta){var dayFlag=event.id.split("#")[2],startDate=getStartDateFromId(scope,event.id),endDate=scope.getNextDayStr(startDate,delta._days),checkedDateList=scope.checkedDateList;if($.inArray(endDate,checkedDateList)<0)return!1;var firstId;return angular.forEach(scope.events,function(_event){event.id==_event.id&&(firstId=event.id,scope.$apply(function(){_event.start=endDate,_event.end=scope.getNextDayStr(endDate)}))}),angular.forEach(scope.events,function(_event){_event.start==endDate&&_event.id!=firstId&&-1!==_event.id.indexOf(dayFlag)&&scope.$apply(function(){scope.reloadCalendarId=_event.id,scope.reloadCalendarEnd=startDate})}),!0},moveOriginalEventToStartDate=function(scope){angular.forEach(scope.events,function(_event){_event.id==scope.reloadCalendarId&&scope.$apply(function(){_event.start=scope.reloadCalendarEnd,_event.end=scope.getNextDayStr(scope.reloadCalendarEnd)})}),$("#calendar").fullCalendar("destroy"),calendar.manualGenerateDuty(scope)},getStartDateFromId=function(scope,id){var result;return angular.forEach(scope.events,function(_event){_event.id==id&&(result=_event.start)}),result},commonImgStr="<img class='calendarTipImg' src='./../assets/global/img/",trueImgStr=commonImgStr+"true.png'/>",falseImgStr=commonImgStr+"false.png'/>";return{init:function(){initCalendar()},registerInitMonth:function(scope){initRegisterCalendar(scope)},autoGenerateDuty:function(scope){initAutoDuty()},manualGenerateDuty:function(scope){initManualDuty(scope)},showLastDuty:function(scope){initLastDuty(scope)}}}();
var UIToastr={show:function(title,msg,type){$.Toast(title||"系统消息",msg||"新消息!",type||"success",{stack:!0,has_icon:!1,has_close_btn:!0,fullscreen:!1,timeout:3e3,sticky:!1,has_progress:!0,rtl:!1,position_class:"toast-top-right"}),document.getElementById("tipMusic").play()}};