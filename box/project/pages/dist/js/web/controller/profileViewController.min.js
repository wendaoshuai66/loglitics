function personalController($scope,$http,$stateParams,$compile,$location,$filter,$timeout,$q,$state){var info=localStorage.getItem("com.logistics.user.info"),user=JSON.parse(info);$scope.url="getUserById",$scope.params={id:user.id},$http({method:"POST",url:$scope.httpDomain+$scope.url,params:$scope.params,headers:{"logistics-session-token":localStorage.getItem("com.logistics.user.token")}}).success(function(e){getSexTypeData($scope,$http,$compile,$location,$filter),$scope.info=e.data,$scope.getSelectInfo()}),$scope.selectCampus=function(){2!==$scope.info.role&&0!==$scope.info.role||!$scope.info.teacher?1!==$scope.info.role&&0!==$scope.info.role||!$scope.info.maintenanceWorker||$scope.getDepartmentList($scope.info.maintenanceWorker.department.campus.id,1):$scope.getDepartmentList($scope.info.teacher.department.campus.id,0)},$scope.getDepartmentList=function(e,o,t){$scope.selectParams={getAll:!1,ifLogistics:o,campusId:e},$q.all([getDepartmentSelectData($scope,$http,$compile,$location,$filter)]).then(function(){$scope.getLevelListFromDepartment($scope),t&&t()})},$scope.getSelectInfo=function(){if(0===$scope.info.role)$q.all([getCampusSelectData($scope,$http,$compile,$location,$filter)]).then(function(){return getPositionSelectData($scope,$http,$compile,$location,$filter)}).then(function(){return getMaintenanceTypeSelectData($scope,$http,$compile,$location,$filter)}).then(function(){$scope.selectCampus()});else if(2===$scope.info.role)$q.all([getCampusSelectData($scope,$http,$compile,$location,$filter)]).then(function(){return getPositionSelectData($scope,$http,$compile,$location,$filter)}).then(function(){$scope.selectCampus()});else{if(1!==$scope.info.role)return;$q.all([getCampusSelectData($scope,$http,$compile,$location,$filter)]).then(function(){return getMaintenanceTypeSelectData($scope,$http,$compile,$location,$filter)}).then(function(){$scope.selectCampus()})}},$scope.changeOldPassword=function(){$scope.oldPasswordValid=!0},$scope.currentPassword=function(){if(!$scope.setPsdForm.setPsw.$invalid){$http({url:$scope.httpDomain+"findUserPassword",method:"POST",data:{data:JSON.stringify({account:$scope.info.account,password:$scope.setPsw,id:$scope.info.id})},headers:{"logistics-session-token":localStorage.getItem("com.logistics.user.token")}}).success(function(e){"SUCCESS"===e.status?$scope.oldPasswordValid=!0:(sweetAlert("警告","原密码错误!","error"),$scope.oldPasswordValid=!1)}).error(function(){sweetAlert("警告","验证异常,请稍后重试!","error"),$scope.oldPasswordValid=!1})}},$scope.checkNewPasswordValidOld=function(){$scope.setPsw===$("#newPassword").val()?($scope.newPasswordValidOld=!1,sweetAlert("警告","新密码不能与原密码一致!","error")):$scope.newPasswordValidOld=!0},$scope.passwordSmt=function(){$http({url:$scope.httpDomain+"updateUserPassword",method:"POST",data:{id:$scope.info.id,password:$("#newPassword").val()},headers:{"logistics-session-token":localStorage.getItem("com.logistics.user.token")}}).success(function(e){"SUCCESS"===e.status?($state.reload(),sweetAlert("提示","已成功修改","success")):sweetAlert("警告","提交失败,请稍后再试！","error")}).error(function(){sweetAlert("警告","提交异常！","error")})},$scope.modifiedData=function(){var userInfo=localStorage.getItem("com.logistics.user.info");userInfo=eval("("+userInfo+")");var postUrl,user=$scope.info;if(1==userInfo.role||0==userInfo.role)postUrl="saveMaintenanceWorker";else if(2==userInfo.role)postUrl="saveTeacher";else{if(3!=userInfo.role)return;postUrl="saveStudent"}$http({url:$scope.httpDomain+postUrl,method:"POST",data:{data:JSON.stringify(user)}}).success(function(e){userInfo.name=$scope.info.name,"images/user/male.jpg"!==userInfo.headPicture&&"images/user/female.jpg"!==userInfo.headPicture||(1===$scope.info.sex?userInfo.headPicture="images/user/male.jpg":userInfo.headPicture="images/user/female.jpg"),2!==$scope.info.role&&0!==$scope.info.role||!$scope.info.teacher?1!==$scope.info.role&&0!==$scope.info.role||!$scope.info.maintenanceWorker||(userInfo.maintenanceTypeID=$scope.info.maintenanceWorker.maintenanceType.id,userInfo.departmentId=$scope.info.maintenanceWorker.department.id,userInfo.departmentName=$scope.info.maintenanceWorker.department.name):(userInfo.departmentId=$scope.info.teacher.department.id,userInfo.departmentName=$scope.info.teacher.department.name),localStorage.setItem("com.logistics.user.info",JSON.stringify(userInfo)),$scope.loginUser.headPicture=userInfo.headPicture,$scope.getLoginUser(),$scope.getScope("UserProfile").user.name=$scope.info.name,$scope.getScope("App").loginUser.name=$scope.info.name,$state.reload(),"SUCCESS"===e.status?sweetAlert("提示","已成功修改","success"):sweetAlert("警告","提交失败,请稍后再试！","error")}).error(function(){sweetAlert("警告","提交异常！","error")})}}angular.module("MetronicApp").controller("personalController",["$scope","$http","$stateParams","$compile","$location","$filter","$timeout","$q","$state",personalController]);