function registerController(e,t,a,n,r,o,s){function i(){o(function(){e.$apply(function(){e.sengMsgStr=c+"秒后可再次发送",e.sendMsgLoading=!0,e.sendMsgStyle={width:"127px","line-height":"32px"}})},0),--c>0?setTimeout(function(){i()},1e3):(o(function(){e.$apply(function(){e.sengMsgStr="发送验证码",e.sendMsgLoading=!1})},0),c=10)}function d(){if(o(function(){e.$apply(function(){e.countdownJumpSecond=e.countdownJumpSecond-1})},0),e.countdownJumpSecond>1)setTimeout(function(){d()},1e3);else{var t=portType+"://"+window.location.host+webLoginSuffix;window.location=t}}e.select2Options={language:"zh-CN"},e.schoolName=schoolName,e.ifOpenApi=ifOpenApi,e.getSelectInfoApi=function(e){if(null!=e){var a=s.defer();return e.ifOpenApi&&t({url:httpDomain+e.selectUrl,method:"POST",data:e.selectParams,headers:{"logistics-session-token":null}}).success(function(t){null!=t.data?(e[e.selectPara]=t.data,a.resolve()):(sweetAlert("警告",e.selectOptName+"失败！","error"),a.reject())}).error(function(){sweetAlert("警告",e.selectOptName+"异常！","error"),a.reject()}),a.promise}},getRegisterTypesData(e,t,a,n,r),getSexTypeData(e,t,a,n,r),s.all([getCampusSelectData(e,t,a,n,r)]),e.data={},e.registerStep=1,e.data.role=3,e.data.sex=1,e.phone=!1,e.phoneRegex=/^1(3|4|5|7|8)\d{9}$/,e.accountRegex=/^[a-zA-Z0-9]*([a-zA-Z][0-9]|[0-9][a-zA-Z])[a-zA-Z0-9]*$/,e.userNameRegex=/^[\u4e00-\u9fa5a-zA-Z]+$/,e.idCardNum=/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/,e.getThisPhoneValid=function(){var t=$("#phone").val();e.phoneNum=t,e.phoneRegex.test(t)?e.phone=!0:e.phone=!1},e.registerStepToTwo=function(){e.registerStep=2},e.registerStepToOne=function(){$("#phone").val(e.phoneNum),e.registerStep=1},e.sengMsgStr="发送验证码",e.sendMsgLoading=!1,e.sendMsgStyle={width:"97px","line-height":"32px"};var c=20;e.sendMsgCode=function(){!0!==e.sendMsgLoading&&(t({url:httpDomain+"sendMessageCode",method:"POST",data:{mobile:e.phoneNum,count:4}}).success(function(e){"SUCCESS"!==e.status&&sweetAlert("警告","验证码获取失败！","error")}).error(function(){sweetAlert("警告","验证码获取异常！","error")}),i())},e.checkMsgCodeValid=function(){4==$("#verifyNo").val().length&&t({url:httpDomain+"checkMessageCode",method:"POST",data:{mobile:e.phoneNum,msgCode:$("#verifyNo").val()}}).success(function(o){"SUCCESS"===o.status?(e.registerStep=3,1==e.data.role?getMaintenanceTypeSelectData(e,t,a,n,r):2==e.data.role&&getPositionSelectData(e,t,a,n,r)):sweetAlert("警告","验证码不正确！","error")}).error(function(){sweetAlert("警告","验证码获校验异常！","error")})},e.getLevelListFromDepartment=function(e){var t=e.departmentSelectData,a=[];angular.forEach(t,function(e){a.push({id:e.id,level:e.treeLevel})}),e.levelList=a},e.formatState=function(t){if(!t.id)return t.text;for(var a=e.levelList,n="",r=t.id.split("number:"),o=r[r.length-1],s=0;s<a.length;s++)if(a[s].id==o)for(var i=0;i<a[s].level;i++)n+="&nbsp;&nbsp;&nbsp;&nbsp;";return $("<span>"+n+t.text+"</span>")},e.select2FormatOptions={language:"zh-CN",templateResult:e.formatState},e.getDepartmentInfoFromCampusId=function(){if(3!=e.data.role){var o;o=1==e.data.role?1:0,e.selectParams={campusId:e.data.campusId,ifLogistics:o},s.all([getDepartmentSelectData(e,t,a,n,r)]).then(function(){return 1===o?getMaintenanceTypeSelectData(e,t,a,n,r):getPositionSelectData(e,t,a,n,r)}).then(function(){e.getLevelListFromDepartment(e)})}},e.checkRepeatAccount=function(){t({url:httpDomain+"checkRepeatAccount",method:"POST",data:{data:JSON.stringify(e.data)}}).success(function(t){"REPEAT"===t.status&&(sweetAlert("警告","账号重复,请更换再试！","warning"),e.data.account="")}).error(function(){sweetAlert("警告","账号获校验异常！","error"),e.data.account=""})},e.checkIdCardNum=function(){var t=e.data.idCardNum;null!=t&&""!=t&&(e.idCardNum.test(t)?e.idCardCheck=!0:(sweetAlert("警告","您输入的不是一个正确格式的身份证号！","error"),e.data.idCardNum=""))},e.saveUserInfo=function(){if(!$("#btn_part3").attr("disabled")){var a=e.data.idCardNum;if(null==a||""==a||e.idCardNum.test(a)){var n,r={name:e.data.name,sex:e.data.sex,account:e.data.account,password:e.data.password,tel:e.phoneNum,role:e.data.role};if(1==e.data.role)n="saveMaintenanceWorker",r.maintenanceWorker={department:{id:e.data.departmentId},maintenanceType:{id:e.data.maintenanceTypeId}};else if(2==e.data.role)n="saveTeacher",r.teacher={department:{id:e.data.departmentId},position:{id:e.data.positionId}};else{if(3!=e.data.role)return;n="saveStudent",r.approvalStatus=0}t({url:httpDomain+n,method:"POST",data:{data:JSON.stringify(r),mobile:e.phoneNum}}).success(function(t){"SUCCESS"===t.status?(sweetAlert("提示","已成功注册","success"),e.registerStep=4,e.countdownJumpSecond=5,d()):sweetAlert("警告","注册失败,请稍后再试！","error")}).error(function(){sweetAlert("警告","注册异常！","error"),e.data.account=""})}}}}var app=angular.module("RegisterApp",["ui.select2"]);app.config(["$httpProvider",function(e){e.defaults.transformRequest=function(e){return void 0===e?e:$.param(e)},e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"}]),angular.module("RegisterApp").controller("registerController",["$scope","$http","$compile","$location","$filter","$timeout","$q",registerController]);