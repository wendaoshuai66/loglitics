function viewMyRepairController(a,t,e,n,i,o,r,l){a.isSaveMsg=!1,getRepairStatusData(a,t,e,n,i),a.getPageData=function(){var l;null===o.id||(l=o.id),a.controllerName="viewMyRepair",a.selectIdList=["select"],t({url:a.httpDomain+"getMaintenanceRecordById",method:"POST",data:{id:l},headers:{"logistics-session-token":a.getToken()}}).success(function(o){if(a.data=o.data,o.imgUrls&&o.imgUrls.uploadFileUrl){a.hasImg=!0;var l=o.imgUrls.uploadFileUrl.split(",");a.image={urls:l}}else a.hasImg=!1;a.initSly();var d=o.data.repairMethod;a.data.repairMethod=1==d?"微信报修":"网页报修",r.all([getMaterialSelectData(a,t,e,n,i)]).then(function(){return getMaintenanceStatusData(a,t,e,n,i)}).then(function(){a.dealStatusAndBindTimeLine(),a.initPiePercent(),a.initDataTable(),a.calculateTime(),a.removeLoading(),ComponentsBootstrapMaxlength.init(["maxlength_textarea2"])}),a.initDataTable=function(){a.columns=[{data:"id"},{data:"material.name"},{data:"material.specificationsModel"},{data:"material.materialCategory.name"},{data:"warrantyNumber.maintenanceNumber"},{data:"stockRemovalCount"},{data:"material.materialUnit.name"},{data:"stockRemovalDate"},{data:"warrantyNumber.maintenanceStaff.name"},{data:"addDateTime"}],a.orderableAry=[0,1,2,3,5,6],a.wrapAry=[1,2,3,4],a.wrapShortAry=[6],a.targetsOpt=10,a.nullStr=[8],a.dateFormatAry=[7,9],a.order=[[7,"desc"]],a.optHtmlAry=["remove"];var o="getStockRemovalList";a.url=o,a.reloadUrl=o,a.initDataTablesName="myMaterialUseDataTable",a.searchObj={warrantyNumber:{maintenanceNumber:a.data.maintenanceNumber}},dataTables.init(a,t,e,n,i)}})},a.getPageData(),a.setMaintenanceDoneStatus=function(){var t=a.getScope("updateMaintenanceStatus");t.data={maintenanceStatus:{id:5}},t.modalTitle="手动设置完成状态",$("#updateMaintenanceStatusModal").modal()},a.remove=function(){$("#removeModal").modal("hide"),a.addLoading(),a.url="deleteStockRemoval",a.optName="删除",a.params={id:a.removeId},r.all([a.postApi(a)]).then(function(){l.reload()})},a.resetInputList=["stockRemovalCount"],a.addModal=function(){var o=a.getScope("myMaterialUseAdd");o.data={},$("#stockRemovalCount").attr("disabled","disabled"),a.resetErrorInput(o,t,e,n,i),a.modalTitle="添加出库信息",o.controllerName="myMaterialUse",a.triggerSelect(a,t,e,n,i),a.resetForm(o,t,e,n,i),$("#addModal").modal()},a.dealStatusAndBindTimeLine=function(){var t=angular.copy(a.maintenanceStatusData),e=a.data.maintenanceRecord.maintenanceStatus.weight<<0;a.statusAllDown=e>=6;var n=[];angular.forEach(t,function(t){e<=6?t.weight<<0<e&&n.push(t):a.data.maintenanceRecord.maintenanceStatus.id>6&&t.weight<<0<3&&n.push(t)}),n.sort(function(a,t){return(a.weight<<0)-(t.weight<<0)}),a.beforeStatusObj=n},a.initPiePercent=function(){var t={value:a.data.maintenanceRecord.maintenanceStatus.percent.split("%")[0],name:"当前进度",backgroundColor:null,color:[a.data.maintenanceRecord.maintenanceStatus.percentRGB,"#cccccc"],fontSize:15,domEle:document.getElementById("pieDiagram")};new PercentPie(t).init(l)},a.calculateTime=function(){var t=a.data.maintenanceTime;t&&"null"!=t?(a.timeCost=t+"小时",a.timeDown=!0):(a.timeCost="维修未结束",a.timeDown=!1)},a.saveComment=function(){a.url="saveMaintenanceRecord",a.optName="评价",a.params={data:JSON.stringify(a.data)},r.all([a.postApi(a)]).then(function(){a.reloadMyRecordAndRepairState(),a.getPageData()})},a.initSly=function(){var t="";a.image&&a.image.urls?(angular.forEach(a.image.urls,function(a){t+='<li class="carouselShadow">\n\t\t<div class="pic"><a href="'+a+'" target="_blank"><img src="'+a+'" /></a></div>\n</li>'}),$(".picList").append(t),$(".picScroll-left").slide({titCell:".hd ul",mainCell:".bd ul",autoPage:!0,effect:"left",autoPlay:!0,vis:2,trigger:"click"})):$(".picScroll-left").addClass("hide")}}function myMaterialUseAddController(a,t,e,n,i,o,r){a.searchInit=!1,a.option={format:"yyyy-mm-dd",minView:2,endDate:new Date},datePickers.init(a,t,e,n,i),a.selectMaterial=function(){a.data.stockRemovalCount="";var t=angular.copy(a.materialSelectData);angular.forEach(t,function(t){t.id==a.data.material.id&&(a.data.material=t,a.maxCount=a.data.material.inventoryQuantity,a.maxLength=a.maxCount+"".length,$("#stockRemovalCount").attr("max",a.maxCount),$("#stockRemovalCount").removeAttr("disabled")),null==a.data.material.id&&(a.data.material=null,$("#stockRemovalCount").attr("disabled","disabled"))})},a.checkMaxCount=function(){a.data.stockRemovalCount>a.maxCount?(sweetAlert("警告","最大可出库数量为:"+a.maxCount+"个","error"),a.maxCountError=!0):a.maxCountError=!1},a.save=function(){$("#addModal").modal("hide"),a.url="saveStockRemoval",void 0!==a.data.id?a.optName="修改":(a.dataRefresh=!0,a.optName="添加"),a.data.warrantyNumber={id:a.$parent.data.id},a.params={data:JSON.stringify(a.data)},o.all([a.postApi(a)]).then(function(){r.reload()})}}function updateMaintenanceStatusController(a,t,e,n,i,o,r){ComponentsBootstrapMaxlength.init(["maxlength_textarea"]),a.statusTypeData=[{id:5,name:"维修完成",value:"5"},{id:7,name:"重复报修",value:"7"},{id:8,name:"无法维修",value:"8"}],a.data={maintenanceStatus:{id:5}},a.save=function(){$("#updateMaintenanceStatusModal").modal("hide");var t=a.data.maintenanceStatus.id,e=a.data.unableRepairReason;a.url="completionMaintenanceRecordForWorker";var n=a.getScope("viewMyRepair").data.id;a.params={maintenanceStatusId:t,unableRepairReason:e,id:n},a.optName="手动设置完成状态",o.all([a.postApi(a)]).then(function(){a.reloadMyRecordAndRepairState(),r.reload()})}}angular.module("MetronicApp").controller("viewMyRepairController",["$scope","$http","$compile","$location","$filter","$stateParams","$q","$state",viewMyRepairController]),angular.module("MetronicApp").controller("myMaterialUseAddController",["$scope","$http","$compile","$location","$filter","$q","$state",myMaterialUseAddController]),angular.module("MetronicApp").controller("updateMaintenanceStatusController",["$scope","$http","$compile","$location","$filter","$q","$state",updateMaintenanceStatusController]);