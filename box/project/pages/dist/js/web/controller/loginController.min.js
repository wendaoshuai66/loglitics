function loginController(e,t){e.verifyValidate=!1;var o=function(t){t.appendTo("#captcha"),t.onSuccess(function(){e.verifyValidate=!0}),t.onError(function(){e.verifyValidate=!1}),window.gt=t};t({url:httpDomain+"getGeetestResStr",method:"POST"}).success(function(e){initGeetest({gt:e.gt,challenge:e.challenge,offline:!e.success,new_captcha:!e.new_captcha||e.new_captcha,product:"float",width:"100%"},o)}),e.loadingConfig={loadingWidth:120,title:"正在登录...",name:"test",discription:"",direction:"column",type:"pic",imgSrc:"./../assets/global/img/loading.gif",originDivWidth:40,originDivHeight:40,originWidth:6,originHeight:6,smallLoading:!1,loadingMaskBg:"rgba(0,0,0,0.2)"},e.addLoading=function(){$("body").loading(e.loadingConfig)},e.removeLoading=function(){removeLoading("test")},e.getToken=function(){return localStorage.getItem("com.logistics.user.token")};var r=localStorage.getItem("com.logistics.user.rememberme"),a=localStorage.getItem("com.logistics.user.username"),i=localStorage.getItem("com.logistics.user.expired");"0"===localStorage.getItem("com.logistics.user.exit")&&sweetAlert("提示","已成功注销","success");localStorage.setItem("com.logistics.user.exit",!1);"true"===i&&(sweetAlert({title:"登录信息已过期！",text:"请重新登录",type:"warning",timer:2e3,showConfirmButton:!1}),localStorage.setItem("com.logistics.user.expired","false")),e.data={},null==r?localStorage.setItem("com.logistics.user.rememberme",!1):e.data.rememberme="true"==r,e.data.rememberme&&null!=a&&"undefined"!=a&&(e.data.username=a),e.login=function(){e.verifyValidate?(e.addLoading(),e.data.rememberme&&localStorage.setItem("com.logistics.user.username",e.data.username),e.url="login",e.params={rememberme:e.data.rememberme,account:e.data.username,password:e.data.password},t({url:httpDomain+e.url,method:"POST",data:e.params,headers:{"logistics-session-token":e.getToken()}}).success(function(t,o,r,a){null!=t&&"NOTLOGIN"!==t.status||(sweetAlert("警告","密码已过期,请重新输入","warning"),delete e.data.password,localStorage.setItem("com.logistics.user.token",null),localStorage.setItem("com.logistics.user.login",!1)),"SUCCESS"===t.status?(localStorage.setItem("com.logistics.user.login",!0),localStorage.setItem("com.logistics.user.token",t.token),localStorage.setItem("com.logistics.user.info",JSON.stringify(t.user)),localStorage.setItem("com.logistics.user.exit","1"),e.loginCallback()):"ERROR"===t.status||"NOUSER"===t.status?(sweetAlert("警告","用户名、密码错误！","error"),localStorage.setItem("com.logistics.user.login",!1)):(sweetAlert("警告","其他错误！","error"),localStorage.setItem("com.logistics.user.login",!1)),e.removeLoading()}).error(function(t,o,r,a){localStorage.setItem("com.logistics.user.login",!1),sweetAlert("警告","登录异常,请重试!","error"),e.removeLoading()})):sweetAlert("警告","请完成验证码验证!","warning")},e.loginCallback=function(e){var t=portType+"://"+window.location.host+webLocationSuffix;window.location=t},e.changeRemember=function(){localStorage.setItem("com.logistics.user.rememberme",e.data.rememberme)}}var app=angular.module("LoginApp",[]);app.controller("loginController",["$scope","$http",loginController]),app.factory("sessionInjector",["$rootScope",function(e){var t=localStorage.getItem("com.logistics.user.token");return{request:function(e){return e.headers["logistics-session-token"]=t,e}}}]),app.config(["$httpProvider",function(e){e.defaults.transformRequest=function(e){return void 0===e?e:$.param(e)},e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"}]);