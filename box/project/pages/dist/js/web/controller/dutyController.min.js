function dutyController(t,e,a,n,o,r){t.data={},t.searchObj={ifLogistics:1,getDutyInfo:!0,status:1},t.controllerName="duty",t.data.maintenanceItems=[],t.columns=[{data:"id"},{data:"name"},{data:"campus.name"},{data:"parent.name"},{data:"description"},{data:"typeList"},{data:"dateStr"},{data:"addDateTime"}],t.orderableAry=[0,3],t.htmlType=[4],t.wrapAry=[2,3],t.wrapLongAry=[1],t.targetsOpt=8,t.order=[[7,"desc"]],t.optHtmlAry=["dutyList"];var d="getDepartmentList";t.url=d,t.reloadUrl=d,t.initDataTablesName="dutyDataTable",dataTables.init(t,e,a,n,o),t.dutyList=function(e,a,n){localStorage.setItem("com.logistics.duty.departmentSelectedId",e),localStorage.setItem("com.logistics.duty.dutyShowDepartmentName",a);var o="";n&&(o=t.loginUser.maintenanceTypeID),localStorage.setItem("com.logistics.duty.dutyShowMaintenanceTypeID",o),r.go("dutyDetail",{id:e,type:n})}}function dutyShowListController(t,e,a,n,o,r,d,i){var l=localStorage.getItem("com.logistics.duty.departmentSelectedId"),c=localStorage.getItem("com.logistics.duty.dutyShowDepartmentName"),s=localStorage.getItem("com.logistics.duty.dutyShowMaintenanceTypeID"),m=new Date,u=m.getFullYear(),y=m.getMonth()+1;y=y<10?"0"+y:y;var p=u.toString()+"-"+y.toString();t.departmentName=c,t.dutyYearMonth=p,t.maintenanceItems={},t.checkedTypeAndDate=!1,d.all([getMaintenanceTypeSelectData(t,e,a,n,o)]).then(function(){i(function(){t.$apply(function(){t.typeSelectData=s<<0,t.checkedChange()})},0),t.selectIdList=["selectSearch"],t.triggerSelect(t,e,a,n,o)}),t.option={format:"yyyy-mm",weekStart:1,autoclose:!0,startView:3,minView:3,forceParse:!1},t.getTypeNameFromId=function(e){var a=t.maintenanceTypeSelectData;angular.forEach(a,function(a){a.id==e&&(t.typeName=a.name,t.typeId=a.id)})},datePickers.init(t,e,a,n,o),t.dateClick=function(){$("table tfoot .today").html("本月")},t.dateClick(),t.checkedChange=function(){$("#checkedTypeAndDate").addClass("hide"),delete t.tableListData,t.getTypeNameFromId(t.typeSelectData),t.dutyYearMonth&&(t.dutyYear=t.dutyYearMonth.substring(0,4),t.dutyMonth=t.dutyYearMonth.substring(5,7)),t.typeSelectData&&t.dutyYearMonth&&(t.checkedTypeAndDate=!0,t.addLoading(),t.selectUrl="getDutiesFromDepartmentTypeAndDate",t.selectParams={departmentId:l<<0,typeId:t.typeId<<0,date:t.dutyYear+"-"+t.dutyMonth},t.selectPara="tableData",d.all([t.getSelectInfoApi(t)]).then(function(){var e=d.defer(),a=[];return angular.forEach(t.tableData,function(t){var e={};e.time=t.time+" ("+dateUtil.getWeekStr(t.time)+")",e.dayPerson=t.dayPerson,e.nightPerson=t.nightPerson,e.detail=t.holidayName,a.push(e)}),t.tableListData=a,e.resolve(),e.promise}).then(function(){return t.selectUrl="getUserInfoFromDepartmentTypeAndDate",t.selectPara="listData",t.getSelectInfoApi(t)}).then(function(){t.removeLoading(),$("#checkedTypeAndDate").removeClass("hide")}).catch(function(){t.removeLoading()}))},t.saveDutyImg=function(){var e=$("#dutyTable");html2canvas(e,{onrendered:function(e){e.setAttribute("id","thecanvas"),document.getElementById("canvasImg").appendChild(e);var a=document.getElementById("thecanvas"),n=Canvas2Image.saveAsPNG(a,!0).getAttribute("src");t.saveImage(n,t.departmentName+" , "+t.typeName+" , "+t.dutyYear+" 年 "+t.dutyMonth+" 月 值班表",a)}})},t.printDutyTable=function(){$("#dutyTable").print()}}angular.module("MetronicApp").controller("dutyController",["$scope","$http","$compile","$location","$filter","$state",dutyController]),angular.module("MetronicApp").controller("dutyShowListController",["$scope","$http","$compile","$location","$filter","$state","$q","$timeout",dutyShowListController]);