var BrowserVersion=function(){return function(){var explorer=window.navigator.userAgent.toLowerCase();if(explorer.indexOf("msie")>=0)return{type:"IE",version:ver=explorer.match(/msie ([\d.]+)/)[1]};if(explorer.indexOf("firefox")>=0)return{type:"Firefox",version:ver=explorer.match(/firefox\/([\d.]+)/)[1]};if(explorer.indexOf("chrome")>=0)return{type:"Chrome",version:ver=explorer.match(/chrome\/([\d.]+)/)[1]};if(explorer.indexOf("opera")>=0)return{type:"Opera",version:ver=explorer.match(/opera.([\d.]+)/)[1]};if(explorer.indexOf("Safari")>=0){var ver=explorer.match(/version\/([\d.]+)/)[1];return{type:"Safari",version:ver}}}()}();
var app=angular.module("MetronicApp",["ui.router","ui.bootstrap","oc.lazyLoad","ngSanitize","ui.select2","w5c.validator","frapontillo.bootstrap-switch","ngProgress"]);app.config(["$ocLazyLoadProvider",function($ocLazyLoadProvider){$ocLazyLoadProvider.config({})}]),app.config(["$controllerProvider",function($controllerProvider){$controllerProvider.allowGlobals()}]),app.factory("sessionInjector",["$rootScope",function($rootScope){var token=localStorage.getItem("com.logistics.user.token");return{request:function(config){return config.headers["logistics-session-token"]=token,config}}}]),app.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.transformRequest=function(data){return void 0===data?data:$.param(data)},$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"}]),app.config(["$controllerProvider",function($controllerProvider){$controllerProvider.allowGlobals()}]),app.config(["w5cValidatorProvider",function(w5cValidatorProvider){w5cValidatorProvider.config({blurTrig:!1,showError:!0,removeError:!0}),w5cValidatorProvider.setRules({email:{required:"邮箱不能为空",email:"邮箱格式不正确"},userName:{required:"用户名不能为空",pattern:"用户名必须输入字母、数字、下划线,以字母开头"},password:{required:"密码不能为空",minlength:"密码长度不能小于{minlength}",maxlength:"密码长度不能大于{maxlength}"},number:{required:"数字不能为空"},positiveInteger:{required:"数字不能为空",pattern:"数字只能为正整数"},doubleNumber:{required:"数字不能为空",pattern:"只能为正数，且最多两位小数"},modelName:{required:"型号名称不能为空",pattern:"型号名称不符合规范",minlength:"型号名称长度不能小于{minlength}",maxlength:"型号名称长度不能大于{maxlength}"},moduleName:{required:"模块名称不能为空",pattern:"模块名称不符合规范",minlength:"模块名称长度不能小于{minlength}",maxlength:"模块名称长度不能大于{maxlength}"},reply:{required:"回复内容不能为空"},personName:{required:"人员名称不能为空",pattern:"人员名称不符合规范",minlength:"人员名称长度不能小于{minlength}",maxlength:"人员名称长度不能大于{maxlength}"},personName2:{required:"人员名称不能为空",pattern:"人员名称不符合规范",minlength:"人员名称长度不能小于{minlength}",maxlength:"人员名称长度不能大于{maxlength}"},documents:{required:"单号名称不能为空",pattern:"单号名称不符合规范",minlength:"单号名称长度不能小于{minlength}",maxlength:"单号名称长度不能大于{maxlength}"},address:{required:"地点名称不能为空",pattern:"地点名称不符合规范",minlength:"地点名称长度不能小于{minlength}",maxlength:"地点名称长度不能大于{maxlength}"},name:{required:"名称不能为空",pattern:"名称不符合规范",minlength:"名称长度不能小于{minlength}",maxlength:"名称长度不能大于{maxlength}"},name2:{required:"输入不能为空",pattern:"输入不符合规范",minlength:"输入长度不能小于{minlength}",maxlength:"输入长度不能大于{maxlength}"},name3:{required:"输入不能为空",pattern:"输入不符合规范",minlength:"输入长度不能小于{minlength}",maxlength:"输入长度不能大于{maxlength}"},name4:{required:"输入不能为空",pattern:"输入不符合规范",minlength:"输入长度不能小于{minlength}",maxlength:"输入长度不能大于{maxlength}"},name5:{required:"输入不能为空",pattern:"输入不符合规范",minlength:"输入长度不能小于{minlength}",maxlength:"输入长度不能大于{maxlength}"},title:{required:"标题不能为空",pattern:"标题不符合规范",minlength:"标题长度不能小于{minlength}",maxlength:"标题长度不能大于{maxlength}"},url:{required:"链接不能为空",pattern:"链接不符合规范",minlength:"链接长度不能小于{minlength}",maxlength:"链接长度不能大于{maxlength}"},select:{required:"下拉框内容不能为空"},select2:{required:"下拉框内容不能为空"},select3:{required:"下拉框内容不能为空"},select4:{required:"下拉框内容不能为空"},multipleSelect:{required:"多选下拉框内容不能为空"},multipleSelect2:{required:"多选下拉框内容不能为空"},multipleSelect3:{required:"多选下拉框内容不能为空"},multipleSelect4:{required:"多选下拉框内容不能为空"},idCardNum:{required:"身份证号不能为空",pattern:"身份证号格式不正确"},phoneNum:{required:"手机号不能为空",pattern:"手机号格式不正确"},date:{required:"日期不能为空"},description:{required:"内容不能为空",minlength:"内容长度不能小于{minlength}",maxlength:"内容长度不能大于{maxlength}"},registerName:{required:"账号不能为空",pattern:"只能为字母、数字,不能为纯数字或字母",minlength:"账号只能为8位",maxlength:"账号只能为8位"}})}]),app.factory("settings",["$rootScope",function($rootScope){var settings={layout:{pageSidebarClosed:!1,pageContentWhite:!0,pageBodySolid:!1,pageAutoScrollOnLoad:1e3},assetsPath:"../assets",globalPath:"../assets/global",layoutPath:"../assets/layouts/layout3"};return $rootScope.settings=settings,settings}]),app.controller("AppController",["$scope","$rootScope","$location","$timeout","$http","$q","ngProgressFactory","$window","$state","$compile",function($scope,$rootScope,$location,$timeout,$http,$q,ngProgressFactory,$window,$state,$compile){$rootScope.httpDomain=httpDomain,$rootScope.schoolName=schoolName,$rootScope.ifOpenApi=ifOpenApi,$rootScope.maxAlarmValue=maxAlarmValue;var loginStatus=localStorage.getItem("com.logistics.user.login");$scope.loginStatus="true"===loginStatus,$scope.loginStatus,$scope.$on("$viewContentLoaded",function(){App.initAjax()}),$rootScope.progressbar=ngProgressFactory.createInstance(),$rootScope.progressbar.setHeight("4px"),$rootScope.progressbar.setColor("#36D7B7"),$rootScope.$on("$locationChangeStart",function(event,toState,toParams,fromState,fromParams){$rootScope.checkStateChange(event,toState,toParams,fromState,fromParams);var flag=100!==$rootScope.progressbar.status();flag?$rootScope.progressbar.set(100):($rootScope.progressbar.start(),$timeout(function(){flag&&$rootScope.progressbar.complete()},3e3))}),$rootScope.$on("$viewContentLoaded",function(){$rootScope.progressbar.complete()}),$rootScope.$on("$readystatechange",function(event,toState,toParams,fromState,fromParams){$rootScope.checkStateChange(event,toState,toParams,fromState,fromParams)}),$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){$rootScope.checkStateChange(event,toState,toParams,fromState,fromParams)}),$rootScope.checkStateChange=function(event,toState,toParams,fromState,fromParams){var token=localStorage.getItem("com.logistics.user.token"),loginStatus=localStorage.getItem("com.logistics.user.login"),redirectToLogin=function(callback){localStorage.setItem("com.logistics.user.token",null),localStorage.setItem("com.logistics.user.login",!1),localStorage.setItem("com.logistics.user.expired",!0),localStorage.setItem("com.logistics.user.info",null),callback&&callback(),$rootScope.userLogin()};1==loginStatus||"true"==loginStatus?$http({url:httpDomain+"checkAuthority",method:"POST",data:{},headers:{"logistics-session-token":token}}).success(function(data){null!=data&&""!=data&&"EXPIRED"!==data.status||redirectToLogin()}).error(function(){redirectToLogin()}):getAuthorityState.forEach(function(state){toState.name==state&&($location.path(),$location.path("/dashboard.html").replace(),$rootScope.userLogin())})},$rootScope.formatState=function(state){if(!state.id)return state.text;for(var levelList=JSON.parse(localStorage.getItem("departmentScope.levelList")),nbsp="",split=state.id.split("number:"),id=split[split.length-1],p=0;p<levelList.length;p++)if(levelList[p].id==id)for(var i=0;i<levelList[p].level;i++)nbsp+="&nbsp;&nbsp;&nbsp;&nbsp;";return $("<span>"+nbsp+state.text+"</span>")},$rootScope.select2FormatOptions={language:"zh-CN",templateResult:$rootScope.formatState},$rootScope.select2Options={language:"zh-CN"},$rootScope.multipleSelect2={closeOnSelect:!1,language:"zh-CN"},$rootScope.select2NoSearch={minimumResultsForSearch:-1,language:"zh-CN"},$rootScope.validateOptions={blurTrig:!0},$rootScope.regex={name:/^[\u4e00-\u9fa5_a-zA-Z0-9]+$/,telNum:/^1(3|4|5|7|8)\d{9}$/,idCardNum:/^(^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$)|(^[1-9]\d{5}[1-9]\d{3}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])((\d{4})|\d{3}[Xx])$)$/,ip:/^((?:(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d))))$/,enName:/^[a-zA-Z0-9]+$/,positiveInteger:/^[0-9]*[1-9][0-9]*$/,twoDecimal:/^(([1-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/,url:/^((ht|f)tps?):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]$/,personName:/^[\u4e00-\u9fa5a-zA-Z]+$/,chineseName:/^[\u4e00-\u9fa5]+$/,registerAccount:/^[a-zA-Z0-9]*([a-zA-Z][0-9]|[0-9][a-zA-Z])[a-zA-Z0-9]*$/},$rootScope.length={accountMin:8,accountMax:8,shortNameMin:1,shortNameMax:5,simpleNameMin:1,simpleNameMax:10,langNameMin:1,langNameMax:20,addressMin:1,addressMax:50,contentMin:25,contentMax:150,modelMin:1,modelMax:30,passwordMin:6,passwordMax:20,personMin:2,personMax:10,linkNameMin:2,linkNameMax:15,storageCountMin:1,storageCountMax:15,commentMin:5,commentMax:200},$rootScope.loadingConfig={loadingWidth:120,title:"",name:"test",discription:"",direction:"column",type:"origin",originDivWidth:40,originDivHeight:40,originWidth:6,originHeight:6,smallLoading:!1,loadingMaskBg:"rgba(0,0,0,0.2)"},$rootScope.addLoading=function(){$("body").loading($rootScope.loadingConfig)},$rootScope.removeLoading=function(){removeLoading("test")},$rootScope.toNewPage=function($scope,data){var pageState=data.pageState;$scope.$state.go(pageState,{messageData:data})},$rootScope.removeModal=function(id){$rootScope.removeId=id,$("#removeModal").modal()},$rootScope.resetPswModal=function(id){$rootScope.resetPswId=id,$("#resetPswModal").modal()},$rootScope.searchInfo=function($scope){$rootScope.addLoading();var tableStr="dataTable";$scope.initDataTablesName&&(tableStr=$scope.initDataTablesName),$("#"+tableStr).DataTable().ajax.reload(function(){$rootScope.removeLoading()},!0)},$rootScope.clearQueue=function(){$scope.getScope("slideUpload").uploader.clearQueue(),$("#myUpload").val("")},$rootScope.toBack=function(){window.history.back(-1)},$rootScope.postApi=function($scope,callBack){var deferred=$q.defer();return $rootScope.ifOpenApi&&$http({url:$scope.httpDomain+$scope.url,method:"POST",data:$scope.params,headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data,status,headers,config){if("SUCCESS"===data.status?(sweetAlert("提示",$scope.optName+"成功！","success"),deferred.resolve()):(sweetAlert("警告",$scope.optName+"失败！","error"),deferred.reject()),$scope.stateNewPage)$scope.returnControllerName&&($scope.removeLoading(),$scope.$state.go($scope.returnControllerName,{messageData:null}));else{$scope.url=$scope.reloadUrl;var tableStr="dataTable";$scope.initDataTablesName&&(tableStr=$scope.initDataTablesName);var refresh=!1;void 0===$scope.data.id&&1==$scope.dataRefresh&&(refresh=!0,$scope.dataRefresh=!1),$("#"+tableStr).DataTable().ajax.reload(function(){$scope.removeLoading(),null!=callBack&&callBack()},refresh)}}).error(function(data,status,headers,config){sweetAlert("警告",$scope.optName+"异常！","error"),$scope.removeLoading(),deferred.reject()}),$scope.ifOpenApi||$scope.changeStatusType&&$scope.changeStatusId&&($scope[$scope.changeStatusType+$scope.changeStatusId]=!$scope[$scope.changeStatusType+$scope.changeStatusId]),null!=callBack&&callBack(),deferred.promise},$rootScope.postApiNoReload=function($scope){var deferred=$q.defer();return $rootScope.ifOpenApi&&$http({url:$scope.httpDomain+$scope.url,method:"POST",data:$scope.params,headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data,status,headers,config){"SUCCESS"===data.status?(sweetAlert("提示",$scope.optName+"成功！","success"),deferred.resolve()):(sweetAlert("警告",$scope.optName+"失败！","error"),deferred.reject()),$scope.url=$scope.reloadUrl,$scope.removeLoading()}).error(function(data,status,headers,config){sweetAlert("警告",$scope.optName+"异常！","error"),$scope.removeLoading(),deferred.reject()}),$scope.ifOpenApi||$scope.removeLoading(),deferred.promise},$rootScope.getSelectInfoApi=function($scope){if(null!=$scope){var deferred=$q.defer();return $rootScope.ifOpenApi&&$http({url:$scope.httpDomain+$scope.selectUrl,method:"POST",data:$scope.selectParams,headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data){null!=data.data?($scope[$scope.selectPara]=data.data,deferred.resolve()):(sweetAlert("警告",$scope.selectOptName+"失败！","error"),deferred.reject())}).error(function(){sweetAlert("警告",$scope.selectOptName+"异常！","error"),deferred.reject()}),deferred.promise}},$scope.materialLessAlarmCount=0,$scope.getMaterialLessAlarmInfo=function(){var deferred=$q.defer();return $rootScope.ifOpenApi&&$http({url:$scope.httpDomain+"checkMaterialLessAlarmValue",method:"POST",headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data){null!=data.data&&($scope.materialLessAlarmInfo=data.data,$scope.materialLessAlarmCount=data.count),deferred.resolve()}),deferred.promise};var timeout;$rootScope.checkRepeatApi=function($scope){$scope.params={data:""},$scope.data[$scope.checkRepeatName]&&($scope.ifRepeat=!0,timeout&&$timeout.cancel(timeout),$scope.params={data:JSON.stringify($scope.data)}),$rootScope.ifOpenApi&&(timeout=$timeout(function(){$http({url:$scope.httpDomain+$scope.repeatUrl,method:"POST",data:$scope.params,headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data,status,headers,config){"REPEAT"===data.status?sweetAlert("警告",$scope.repeatName+"重复！请更换再试！","warning"):$scope.ifRepeat=!1}).error(function(data,status,headers,config){sweetAlert("警告",$scope.repeatName+"校验异常！","error")}),timeout=null},800))},$rootScope.getStatusHtml=function($scope,id,type,value){var disabledHtml="";return"fleaMarket"==$scope.controllerName||"lostFound"==$scope.controllerName?"dealStatus"===type&&(disabledHtml="myDisabled"):"myFleaMarket"==$scope.controllerName||"myLostFound"==$scope.controllerName?("dealStatus"===type&&(disabledHtml=$rootScope["approvalStatus"+id]?1==value?"myDisabled":"":"myDisabled"),"approvalStatus"===type&&($rootScope["approvalStatus"+id]=value,disabledHtml="myDisabled")):"maintenanceEvaluation"==$scope.controllerName&&"approvalStatus"===type&&value&&(disabledHtml="myDisabled"),'<div class="mySwitch '+disabledHtml+'" ng-init="'+type+id+"="+value+'" ng-model="'+type+id+'" ng-click="changeStatusModal('+id+",'"+type+"',"+value+')"><div ng-class="'+type+id+"==1?'switchBody1 switchOpen1':'switchBody1 switchClose1'\"><div ng-class=\""+type+id+"==1?'switchBody2 switchOpen2':'switchBody2 switchClose2'\"><i ng-class=\""+type+id+"==1?'fa fa-check':'fa fa-times'\"></i></div></div></div>"},$rootScope.getWrapHtml=function(data,value,maxWidth){return'<div data-microtip="'+data+'" data-microtip-position="right"><div class="wrap-ellipsis" style="max-width:'+maxWidth+'px !important;">'+value+"</div></div>"},$rootScope.getWrapHtmlWithSpecified=function(data,value,position,maxWidth){return'<div data-microtip="'+data+'" data-microtip-position="'+position+'"><div class="wrap-ellipsis" style="max-width:'+maxWidth+'px !important;">'+value+"</div></div>"},$rootScope.toLogin=function(){$rootScope.userLogin()},$rootScope.getUrlHtml=function(value,url){return'<a href="'+url+'" data-microtip="'+value+'" data-microtip-position="right" target="_blank">'+value+"</a>"},$rootScope.changeStatusModal=function(id,type,value){"dealStatus"===type&&$("[ng-model="+type+id+"]").hasClass("myDisabled")||"approvalStatus"!==type&&($rootScope.changeStatusType=type,$rootScope.changeStatusId=id,$("#changeStatusModal").modal())},$rootScope.resetForm=function($scope,$http,$compile,$location,$filter){var $formScope=$rootScope.getScope($scope.controllerName+"Add");$timeout(function(){$formScope.myForm.reset(),$scope.selectIdList&&angular.forEach($scope.selectIdList,function(value,key){var selectValid_=eval("$formScope.myForm."+value);selectValid_.$valid=!0})},0)},$rootScope.resetErrorInput=function($scope,$http,$compile,$location,$filter){$rootScope.getScope($scope.controllerName+"Add");$scope.resetInputList&&angular.forEach($scope.resetInputList,function(value){$scope.data[value]=""})},$rootScope.resetSearch=function($scope,$http,$compile,$location,$filter){var thisScope=$scope;thisScope.searchObj={},null!=thisScope.selectSearchIdList&&thisScope.triggerSelectSearch(thisScope,$http,$compile,$location,$filter)},$rootScope.resetDateTimePicker=function(){var ids=[].slice.call(arguments);angular.forEach(ids,function(id){$("#"+id).datetimepicker("setEndDate",null),$("#"+id).datetimepicker("setStartDate",null)})},$rootScope.uniqueList=function(list){for(var new_arr=[],i=0;i<list.length;i++){var items=list[i];-1==$.inArray(items,new_arr)&&new_arr.push(items)}return new_arr},$rootScope.unEmptyList=function(list){var tempUrl=[];return list.forEach(function(url){url&&"null"!=url&&tempUrl.push(url)}),tempUrl},$rootScope.getToken=function(){return localStorage.getItem("com.logistics.user.token")},$rootScope.toService=function(){$scope.loginStatus||$scope.userLogin()},$rootScope.toMaterialList=function(){$scope.loginStatus?$scope.isWorker?$state.go("materialList"):sweetAlert("警告","非维修人员没有访问权限！","warning"):$scope.userLogin()},$rootScope.toDutyList=function(){$scope.loginStatus?$scope.isWorker?$state.go("dutyList"):sweetAlert("警告","非维修人员没有访问权限！","warning"):$scope.userLogin()},$rootScope.getLoginUser=function(){$rootScope.loginUser=JSON.parse(localStorage.getItem("com.logistics.user.info")),$rootScope.isWorker=!1,!$rootScope.loginUser||0!==$rootScope.loginUser.role&&1!==$rootScope.loginUser.role||($rootScope.isWorker=!0)},$scope.getLoginUser(),$rootScope.focus=function(name,selectName){var $formScope=$rootScope.getScope(name+"Form");$timeout(function(){var select_=eval("$formScope.myForm."+selectName);select_.$viewValue||(select_.$valid=!1,$formScope.myForm.validateElement(selectName))},0)},$rootScope.triggerSelect=function($scope,$http,$compile,$location,$filter){$scope.selectIdList&&$scope.selectIdList.forEach(function(value){$timeout(function(){angular.element("[name="+value+"]").triggerHandler("change")},0)})},$rootScope.triggerSelectSearch=function($scope,$http,$compile,$location,$filter){$scope.selectSearchIdList&&$scope.selectSearchIdList.forEach(function(value){$timeout(function(){angular.element("[name="+value+"]").triggerHandler("change")},0)})},$rootScope.initPagination=function($scope){$scope.vm={},$scope.vm.pageSize=$scope.pageSize?$scope.pageSize:10,$scope.vm.maxSize=5,$scope.vm.totalItems=0,$scope.vm.currentPageItem=1,$scope.changePageSize=function(newValue){$scope.vm.currentPageItem=1,$scope.vm.pageSize=newValue<<0,$scope.getPaginationList()},$scope.getPaginationList=function(){$scope.params={pageSize:$scope.vm.pageSize,start:($scope.vm.currentPageItem-1)*$scope.vm.pageSize,pageNumber:$scope.vm.currentPageItem,order:{name:$scope.orderBy,dir:$scope.orderDir}},$http({url:$scope.httpDomain+$scope.url,method:"POST",data:$.extend($scope.params,$scope.myParams),headers:{"logistics-session-token":$scope.getToken()}}).success(function(data){$scope[$scope.requestListName]=data.data,$scope.vm.totalItems=data.total,$scope.vm.untilSize=Math.min($scope.vm.currentPageItem*$scope.vm.pageSize,$scope.vm.totalItems)})},$scope.changePagination=function(){$scope.getPaginationList()},$scope.getPaginationList()},$rootScope.checkValidateWithSensitive=function(thisEvent,model){var _val=thisEvent.target.value;_val&&allSensitiveName.forEach(function(value){if(_val.toLowerCase()==value.toLowerCase()){sweetAlert("警告","不允许输入敏感字符,请重新输入","warning");var splits=model.split("."),thisScope=angular.element($(thisEvent.target)).scope();$timeout(function(){thisScope.$apply(function(){thisScope[splits[0]][splits[1]]=""})},0)}})},$rootScope.getNextDayStr=function(todayStr,delta){var day=1;null!=delta&&(day=delta<<0);var second=new Date(todayStr).getTime(),add=864e5*day;return new Date(second+add).Format("yyyy-MM-dd")},$rootScope.getScope=function(controllerName){var appElement=document.querySelector("[ng-controller="+controllerName+"Controller]");return angular.element(appElement).scope()},$rootScope.getLabelautyHtmlStr=function(scope){var timeTitles=["全部","本年","本月","本周","昨天","今天"],timeHtml="";return scope.timeTitles&&(timeTitles=scope.timeTitles),timeTitles.forEach(function(value,index){timeHtml+='<input type="checkbox" data-labelauty="'+value+'" ng-model="time._'+index+'" ng-click="changeTime(\'_'+index+"')\"/>\n"}),timeHtml},$rootScope.getThisYearUseDateInfo=function(scope){var date=new Date,year=date.Format("yyyy"),month=date.Format("MM"),_time=date.getDay();_time=0===_time?7:_time;var curMonthDays=new Date(date.getFullYear(),date.getMonth()+1,0).getDate(),weekStartDate=$rootScope.getNextDayStr(date.Format("yyyy-MM-dd"),1-_time),weekEndDate=$rootScope.getNextDayStr(weekStartDate,6),yesterday_milliseconds=date.getTime()-864e5,yesterday=new Date;yesterday.setTime(yesterday_milliseconds),scope.thisYearUseDateInfo={},scope.thisYearUseDateInfo={thisYear:{start:year+"-01-01",end:year+"-12-31",type:1},thisMonth:{start:year+"-"+month+"-01",end:year+"-"+month+"-"+curMonthDays,type:2},thisWeek:{start:weekStartDate,end:weekEndDate,type:3},yesterday:{start:yesterday.Format("yyyy-MM-dd"),end:yesterday.Format("yyyy-MM-dd"),type:4},today:{start:date.Format("yyyy-MM-dd"),end:date.Format("yyyy-MM-dd"),type:5}}},$rootScope.getSearchData=function(scope,state){angular.forEach(scope.params,function(value){$.extend(value,{startTime:scope.addDateTimeStart,endTime:scope.addDateTimeEnd})}),commonECharts.init(scope,state)},$rootScope.changeDateTimeWithBtnType=function(scope,key){var dateStr,key=key.split("_")[1],dateInfo=scope.thisYearUseDateInfo,dateStrList=["thisYear","thisMonth","thisWeek","yesterday","today"],timeObj=$("#dateTimeRange").data("daterangepicker");if(0==key)return $("#dateTimeRange").val(""),scope.addDateTimeStart=null,scope.addDateTimeEnd=null,void $("#dateTimeRange").parent().addClass("hide");$("#dateTimeRange").parent().removeClass("hide");var obj=dateInfo[dateStr=dateStrList[key-1]],start=obj.start,end=obj.end;scope.addDateTimeStart=start,scope.addDateTimeEnd=end,timeObj.setStartDate(start),timeObj.setEndDate(end)},$rootScope.checkBtnFromDateRange=function(scope,startTime,endTime){for(i=0;i<6;i++)scope.$apply(function(){scope.time["_"+i]=!1});var dateObj=scope.thisYearUseDateInfo;for(var i in dateObj){var obj=dateObj[i];if(obj.start==startTime&&obj.end==endTime){var _type=obj.type<<0;scope.$apply(function(){scope.time["_"+_type]=!0})}}},$rootScope.initDateTimeRange=function(scope){$("#dateTimeRange").daterangepicker({applyClass:"btn-sm btn-success",cancelClass:"btn-sm btn-default",locale:{applyLabel:"确认",cancelLabel:"取消",fromLabel:"起始时间",toLabel:"结束时间",customRangeLabel:"自定义",firstDay:1,format:scope.dateTimeRange.format||"YYYY-MM-DD",separator:"   至   ",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},timePicker:!1,ranges:scope.dateTimeRange.ranges||{"今日":[moment().startOf("day"),moment()],"昨日":[moment().subtract("days",1).startOf("day"),moment().subtract("days",1).endOf("day")],"最近7日":[moment().subtract("days",6),moment()],"最近30日":[moment().subtract("days",29),moment()],"本月":[moment().startOf("month"),moment().endOf("month")],"上个月":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]},timePickerIncrement:scope.dateTimeRange.increment||1440,startDate:scope.dateTimeRange.myStartDate||scope.thisYearUseDateInfo.thisWeek.start,endDate:scope.dateTimeRange.myEndDate||scope.thisYearUseDateInfo.thisWeek.end,opens:"left"},function(start,end,label){var _start=start.format(scope.dateTimeRange.format||"YYYY-MM-DD"),_end=end.format(scope.dateTimeRange.format||"YYYY-MM-DD");scope.addDateTimeStart=_start,scope.addDateTimeEnd=_end,scope.checkBtnFromDateRange(scope,_start,_end),scope.getSearchData(scope,$state)})},$rootScope.initDateRangeAndLabelauty=function(scope){scope.data=[],scope.time=[];var num=scope.dateTimeRange.myCheckedTime||3;scope.time["_"+num]=!0,scope.getThisYearUseDateInfo(scope),scope.addDateTimeStart=scope.dateTimeRange.myStartDate||scope.thisYearUseDateInfo.thisWeek.start,scope.addDateTimeEnd=scope.dateTimeRange.myEndDate||scope.thisYearUseDateInfo.thisWeek.end;var timeHtml=scope.getLabelautyHtmlStr(scope);$compile($("#time").html(timeHtml))(scope),$(":checkbox").labelauty({minimum_width:"65px"}),scope.initDateTimeRange(scope)},$rootScope.timeLeftAddZero=function(time){return time>9?time:"0"+time},$rootScope.checkValidateWithSensitive=function(thisEvent,model){var _val=thisEvent.target.value;_val&&allSensitiveName.forEach(function(value){if(_val.toLowerCase()==value.toLowerCase()){sweetAlert("警告","不允许输入敏感字符,请重新输入","warning");var splits=model.split("."),thisScope=angular.element($(thisEvent.target)).scope();$timeout(function(){thisScope.$apply(function(){thisScope[splits[0]][splits[1]]=""})},0)}})},$rootScope.specialCharChange=function(str){return str.replace(/&apos;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&nbsp;/g," ")},$rootScope.getLevelListFromDepartment=function(departmentScope){var departmentSelectDataAll=departmentScope.departmentSelectData,levelList=[];angular.forEach(departmentSelectDataAll,function(value){levelList.push({id:value.id,level:value.treeLevel})}),localStorage.setItem("departmentScope.levelList",JSON.stringify(levelList))},$rootScope.saveImage=function(data,filename,canvas){if(canvas.msToBlob){var blob=canvas.msToBlob();window.navigator.msSaveBlob(blob,filename+".png")}else{var save_link=document.createElementNS("http://www.w3.org/1999/xhtml","a");save_link.href=data,save_link.download=filename;var event=document.createEvent("MouseEvents");event.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),save_link.dispatchEvent(event)}},$rootScope.reloadMyRecordAndRepairState=function(){var parent=$rootScope.getScope("header").$parent;parent.initData(parent)},$scope.$on("$viewContentLoaded",function(){}),$rootScope.getControllerPageId=function(key){return localStorage.getItem(key)},$rootScope.setControllerPageId=function(key,value){localStorage.setItem(key,value)},$rootScope.userLogin=function(){var homeUrl=portType+"://"+window.location.host+webLoginSuffix;window.location=homeUrl},$rootScope.userSignOut=function(){$("#signoutModal").modal()},$rootScope.confirmSignOut=function(){$("#signoutModal").modal("hide"),$http({url:$scope.httpDomain+"cleanToken",method:"POST",data:{token:$rootScope.getToken()},headers:{"logistics-session-token":$rootScope.getToken()}}).success(function(data,status,headers,config){"SUCCESS"===data.status?(localStorage.setItem("com.logistics.user.exit","0"),localStorage.setItem("com.logistics.user.token",null),localStorage.setItem("com.logistics.user.login",!1),localStorage.setItem("com.logistics.user.info",null),$scope.loginStatus=!1,$rootScope.userLogin()):sweetAlert("警告","注销失败请重试！","error")}).error(function(data,status,headers,config){sweetAlert("警告",$scope.repeatName+"校验异常！","error")})}}]),app.controller("SidebarController",["$state","$scope",function($state,$scope){$scope.$on("$includeContentLoaded",function(){Layout.initSidebar($state)})}]),app.controller("QuickSidebarController",["$scope",function($scope){$scope.$on("$includeContentLoaded",function(){setTimeout(function(){QuickSidebar.init()},2e3)})}]),app.controller("PageHeadController",["$scope",function($scope){$scope.$on("$includeContentLoaded",function(){Demo.init()})}]),app.controller("ThemePanelController",["$scope",function($scope){$scope.$on("$includeContentLoaded",function(){Demo.init()})}]),app.controller("Footer2Controller",["$scope",function($scope){$scope.$on("$includeContentLoaded",function(){Layout.initFooter()})}]),app.controller("FooterController",["$scope","$http","$compile","$location","$filter",function($scope,$http,$compile,$location,$filter){$scope.url="getFriendLinkInfo",$scope.params={},$scope.getLinkList=function(){$http({url:$scope.httpDomain+$scope.url,method:"POST",data:$scope.params}).success(function(data){$scope.linkList=data.data})},$scope.getLinkList()}]),app.config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise("/dashboard"),$stateProvider.state("dashboard",{url:"/dashboard",templateUrl:"views/dashboard.html",data:{pageTitle:"首页"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/DashboardController.min.js"]})}]}}).state("blank",{url:"/blank",templateUrl:"views/blank.html",data:{pageTitle:"参考模板空白内容页"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"MetronicApp",insertBefore:"#ng_load_plugins_before",files:["js/controllers/BlankController.js"]})}]}}).state("profile",{url:"/profile",templateUrl:"views/profile/main.html",data:{pageTitle:"User Profile"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"MetronicApp",insertBefore:"#ng_load_plugins_before",files:["../assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.css","../assets/pages/css/profile.css","../assets/global/plugins/jquery.sparkline.min.js","../assets/global/plugins/bootstrap-fileinput/bootstrap-fileinput.js","../assets/pages/scripts/profile.min.js","js/controllers/UserProfileController.js"]})}]}}).state("myWorkLogList",{url:"/myWorkLogList",templateUrl:"views/workLog/myList.html",data:{pageTitle:"我的工作日志记录"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"MetronicApp",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myWorkLogController.min.js"]})}]}}).state("profile.view",{params:{id:null},url:"/profile",templateUrl:"views/profile/view.html",data:{pageTitle:"我的个人资料"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"MetronicApp",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/profileViewController.min.js"]})}]}}).state("myRecordsList",{url:"/myRecordsList",templateUrl:"views/repair/repairRecords/list.html",data:{pageTitle:"我的报修记录"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"MetronicApp",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myRecordsController.min.js"]})}]}}).state("viewMyRecord",{params:{id:null},url:"/viewMyRecord?id",templateUrl:"views/repair/repairRecords/view.html",data:{pageTitle:"维修单打印"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myRecordsController.min.js"]})}]}}).state("myRepairList",{url:"/myRepairList",templateUrl:"views/repair/myRepair/list.html",data:{pageTitle:"我的维修记录"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"MetronicApp",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myRepairController.min.js"]})}]}}).state("viewMyRepair",{url:"/viewMyRepair?id",params:{id:null},templateUrl:"views/repair/myRepair/viewMyRepair.html",data:{pageTitle:"我的维修详情"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"MetronicApp",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/viewMyRepairController.min.js","../assets/global/plugins/echarts/4.0.2/echarts.min.js"]})}]}}).state("materialUse",{url:"/materialUse",templateUrl:"views/repair/myRepair/materialUse.html",data:{pageTitle:"物料使用情况"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"MetronicApp",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/materialUseController.min.js"]})}]}}).state("myLostList",{params:{type:1},url:"/myLostList",templateUrl:"views/lostFound/myList.html",data:{pageTitle:"我的失物记录"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myLostFoundController.min.js"]})}]}}).state("myFoundList",{params:{type:0},url:"/myFoundList",templateUrl:"views/lostFound/myList.html",data:{pageTitle:"我的招领记录"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myLostFoundController.min.js"]})}]}}).state("myFleaMarketListSale",{params:{type:1},url:"/myFleaMarketListSale",templateUrl:"views/fleaMarket/myList.html",data:{pageTitle:"我的出售记录"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myFleaMarketController.min.js"]})}]}}).state("myFleaMarketListPurchase",{params:{type:0},url:"/myFleaMarketListPurchase",templateUrl:"views/fleaMarket/myList.html",data:{pageTitle:"我的求购记录"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myFleaMarketController.min.js"]})}]}}).state("mySuggestionList",{url:"/mySuggestionList",templateUrl:"views/suggestion/myList.html",data:{pageTitle:"我的建言献策"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/mySuggestionController.min.js"]})}]}}).state("profile.dashboard",{url:"/dashboard",templateUrl:"views/profile/dashboard.html",data:{pageTitle:"User Profile"}}).state("profile.account",{url:"/account",templateUrl:"views/profile/account.html",data:{pageTitle:"User Account"}}).state("profile.help",{url:"/help",templateUrl:"views/profile/help.html",data:{pageTitle:"User Help"}}).state("newsList",{url:"/newsList",templateUrl:"views/news/list.html",data:{pageTitle:"新闻资讯"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/newsController.min.js"]})}]}}).state("viewNews",{params:{id:null},url:"/viewNews?id",templateUrl:"views/news/view.html",data:{pageTitle:"新闻资讯详情"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/newsController.min.js"]})}]}}).state("suggestionList",{url:"/suggestionList",templateUrl:"views/suggestion/list.html",data:{pageTitle:"建言献策"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/suggestionController.min.js"]})}]}}).state("suggestionAdd",{url:"/suggestionAdd",templateUrl:"views/suggestion/add.html",data:{pageTitle:"建言献策新增"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/mySuggestionController.min.js"]})}]}}).state("viewSuggestion",{params:{id:null},url:"/viewSuggestion?id",templateUrl:"views/suggestion/view.html",data:{pageTitle:"建言献策详情"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/suggestionController.min.js"]})}]}}).state("commonRepair",{url:"/commonRepair",templateUrl:"views/repair/commonRepair/list.html",data:{pageTitle:"普通维修"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/commonRepairController.min.js"]})}]}}).state("specialRepairList",{url:"/specialRepairList",templateUrl:"views/repair/specialRepair/list.html",data:{pageTitle:"专项维修"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/specialRepairController.min.js"]})}]}}).state("specialRepairView",{params:{id:null},url:"/specialRepairView?id",templateUrl:"views/repair/specialRepair/view.html",data:{pageTitle:"专项维修记录详情"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/specialRepairController.min.js"]})}]}}).state("materialView",{params:{id:null},url:"/materialView?id",templateUrl:"views/material/view.html",data:{pageTitle:"物料库存详情"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/materialController.min.js"]})}]}}).state("serviceList",{url:"/serviceList",templateUrl:"views/service/list.html",data:{pageTitle:"便民服务"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/serviceController.min.js"]})}]}}).state("repairRecordsAdd",{url:"/repairRecordsAdd",templateUrl:"views/repair/repairRecords/add.html",data:{pageTitle:"我要报修"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myRecordsController.min.js"]})}]}}).state("lostList",{params:{type:1},url:"/lostList",templateUrl:"views/lostFound/list.html",data:{pageTitle:"失物信息"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/lostFoundController.min.js"]})}]}}).state("foundList",{params:{type:0},url:"/foundList",templateUrl:"views/lostFound/list.html",data:{pageTitle:"招领信息"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/lostFoundController.min.js"]})}]}}).state("viewLostFound",{params:{id:null},url:"/viewLostFound?id",templateUrl:"views/lostFound/view.html",data:{pageTitle:"失物招领详情"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myLostFoundController.min.js"]})}]}}).state("lostAdd",{params:{type:1,id:null},url:"/lostAdd",templateUrl:"views/lostFound/add.html",data:{pageTitle:"失物信息新增"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myLostFoundController.min.js"]})}]}}).state("foundAdd",{params:{type:0,id:null},url:"/foundAdd",templateUrl:"views/lostFound/add.html",data:{pageTitle:"招领信息新增"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myLostFoundController.min.js"]})}]}}).state("fleaMarketListSale",{params:{type:1},url:"/fleaMarketListSale",templateUrl:"views/fleaMarket/list.html",data:{pageTitle:"出售信息"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/fleaMarketController.min.js"]})}]}}).state("fleaMarketListPurchase",{params:{type:0},url:"/fleaMarketListPurchase",templateUrl:"views/fleaMarket/list.html",data:{pageTitle:"求购信息"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/fleaMarketController.min.js"]})}]}}).state("viewFleaMarket",{params:{id:null},url:"/viewFleaMarket?id",templateUrl:"views/fleaMarket/view.html",data:{pageTitle:"出售求购详情"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myFleaMarketController.min.js"]})}]}}).state("fleaMarketAddSale",{params:{type:1,id:null},url:"/fleaMarketAddSale",templateUrl:"views/fleaMarket/add.html",data:{pageTitle:"出售新增"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myFleaMarketController.min.js"]})}]}}).state("fleaMarketAddPurchase",{params:{type:0,id:null},url:"/fleaMarketAddPurchase",templateUrl:"views/fleaMarket/add.html",data:{pageTitle:"求购新增"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myFleaMarketController.min.js"]})}]}}).state("workLogList",{url:"/workLogList",templateUrl:"views/workLog/list.html",data:{pageTitle:"工作日志"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/workLogController.min.js"]})}]}}).state("workLogAdd",{url:"/workLogAdd",templateUrl:"views/workLog/add.html",data:{pageTitle:"添加工作日志"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myWorkLogController.min.js"]})}]}}).state("workLogView",{params:{id:null},url:"/workLogView?id",templateUrl:"views/workLog/view.html",data:{pageTitle:"工作日志详情"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/myWorkLogController.min.js"]})}]}}).state("materialList",{url:"/materialList",templateUrl:"views/material/list.html",data:{pageTitle:"物流库存信息"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/materialController.min.js"]})}]}}).state("hourStatistics",{url:"/hourStatistics",templateUrl:"views/charts/maintenanceStatisticWithTime/hourStatistics.html",data:{pageTitle:"24小时分时统计"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/hourStatisticsController.min.js","../assets/global/plugins/echarts/4.0.2/echarts.min.js"]})}]}}).state("weekStatistics",{url:"/weekStatistics",templateUrl:"views/charts/maintenanceStatisticWithTime/weekStatistics.html",data:{pageTitle:"周期分时统计"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/weekStatisticsController.min.js","../assets/global/plugins/echarts/4.0.2/echarts.min.js"]})}]}}).state("monthStatistics",{url:"/monthStatistics",templateUrl:"views/charts/maintenanceStatisticWithTime/monthStatistics.html",data:{pageTitle:"月度分时统计"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/monthStatisticsController.min.js","../assets/global/plugins/echarts/4.0.2/echarts.min.js"]})}]}}).state("repairOriginStatistics",{url:"/repairOriginStatistics",templateUrl:"views/charts/maintenanceStatisticWithType/repairOriginStatistics.html",data:{pageTitle:"报修来源分类统计"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/repairOriginStatisticsController.min.js","../assets/global/plugins/echarts/4.0.2/echarts.min.js"]})}]}}).state("maintenanceTypeStatistics",{url:"/maintenanceTypeStatistics",templateUrl:"views/charts/maintenanceStatisticWithType/maintenanceTypeStatistics.html",data:{pageTitle:"维修项目分类统计"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/maintenanceTypeStatisticsController.min.js","../assets/global/plugins/echarts/4.0.2/echarts.min.js"]})}]}}).state("maintenanceAreaStatistics",{url:"/maintenanceAreaStatistics",templateUrl:"views/charts/maintenanceStatisticWithType/maintenanceAreaStatistics.html",data:{pageTitle:"维修区域分类统计"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/maintenanceAreaStatisticsController.min.js","../assets/global/plugins/echarts/4.0.2/echarts.min.js"]})}]}}).state("timeCostStatistics",{url:"/timeCostStatistics",templateUrl:"views/charts/maintenanceStatisticWithQuality/timeCostStatistics.html",data:{pageTitle:"维修用时分类统计"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/timeCostStatisticsController.min.js","../assets/global/plugins/echarts/4.0.2/echarts.min.js"]})}]}}).state("maintenanceStatusStatistics",{url:"/maintenanceStatusStatistics",templateUrl:"views/charts/maintenanceStatisticWithQuality/maintenanceStatusStatistics.html",data:{pageTitle:"维修评价分类统计"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/maintenanceStatusStatisticsController.min.js","../assets/global/plugins/echarts/4.0.2/echarts.min.js"]})}]}}).state("evaluationStatistics",{url:"/evaluationStatistics",templateUrl:"views/charts/maintenanceStatisticWithQuality/evaluationStatistics.html",data:{pageTitle:"维修状态分类统计"},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/evaluationStatisticsController.min.js","../assets/global/plugins/echarts/4.0.2/echarts.min.js"]})}]}}).state("dutyList",{url:"/duty/dutyList",templateUrl:"views/duty/list.html",data:{pageTitle:"值班安排信息"},params:{messageData:null},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/dutyController.min.js"]})}]}}).state("dutyDetail",{url:"/duty/dutyDetail?id&type",templateUrl:"views/duty/detail.html",data:{pageTitle:"值班表"},params:{id:null,type:null},resolve:{deps:["$ocLazyLoad",function($ocLazyLoad){return $ocLazyLoad.load({name:"app",insertBefore:"#ng_load_plugins_before",files:["../dist/js/web/controller/dutyController.min.js"]})}]}})}]),app.run(["$rootScope","settings","$state",function($rootScope,settings,$state){$rootScope.$state=$state,$rootScope.$settings=settings}]);
angular.module("MetronicApp").directive("ngSpinnerBar",["$rootScope","$state",function($rootScope,$state){return{link:function(scope,element,attrs){element.addClass("hide"),$rootScope.$on("$stateChangeStart",function(){element.removeClass("hide")}),$rootScope.$on("$stateChangeSuccess",function(ev,to,toParams,from,fromParams){element.addClass("hide"),$("body").removeClass("page-on-load"),Layout.setAngularJsMainMenuActiveLink("match",null,$state),setTimeout(function(){App.scrollTop()},$rootScope.settings.layout.pageAutoScrollOnLoad),$rootScope.previousState=from,$rootScope.previousParams=fromParams,$rootScope.nowState=to,$rootScope.ifDashboard=!1,"/dashboard"===$rootScope.nowState.url&&($rootScope.ifDashboard=!0)}),$rootScope.$on("$stateNotFound",function(){element.addClass("hide")}),$rootScope.$on("$stateChangeError",function(){element.addClass("hide")})}}}]),angular.module("MetronicApp").directive("a",function(){return{restrict:"E",link:function(scope,elem,attrs){(attrs.ngClick||""===attrs.href||"#"===attrs.href)&&elem.on("click",function(e){e.preventDefault()})}}}),angular.module("MetronicApp").directive("dropdownMenuHover",function(){return{link:function(scope,elem){elem.dropdownHover()}}}),angular.module("MetronicApp").directive("dateRangeAndLabelauty",function(){return{restrict:"EA",replace:!0,scope:!1,template:'<div class="col-md-12" style="padding: 10px;">\n    <div class="col-md-2 checkBoxLabel">\n        <p class="text-center">时间范围选择</p>\n    </div>\n    <div class="col-md-10 vertical-center">\n        \x3c!-- 时间拼接入口 --\x3e\n        <div class="col-md-8" id="time" style="padding-left: 0px!important;"></div>\n        \x3c!-- 自定义时间范围 --\x3e\n        <div class="col-md-4 input-group" style="right: 15px">\n            <input type="text" readonly class="form-control date-picker" id="dateTimeRange" value="" />\n            <span class="input-group-addon">\n                <i class="fa fa-calendar"></i>\n            </span>\n        </div>\n    </div>\n</div>'}}),angular.module("MetronicApp").directive("repeatFinish",function(){return{link:function(scope,element,attr){1==scope.$last&&scope.$eval(attr.repeatFinish)}}});
function GeneralPageController($rootScope,$scope,settings){$scope.$on("$viewContentLoaded",function(){App.initAjax(),$rootScope.settings.layout.pageContentWhite=!0,$rootScope.settings.layout.pageBodySolid=!1,$rootScope.settings.layout.pageSidebarClosed=!1})}angular.module("MetronicApp").controller("GeneralPageController",GeneralPageController);
function pageHeadController($scope,$http,$compile,$location,$filter){}angular.module("MetronicApp").controller("pageHeadController",["$scope","$http","$compile","$location","$filter",pageHeadController]);
function headerController($scope,$q,$stateParams,$state){$scope.$on("$includeContentLoaded",function(){Layout.initHeader()}),$scope.myState=$state,$scope.getIsServiceInfo=function(){return $scope.selectUrl="getWarrantyNumberIsServiceListByUserId",$scope.selectParams={userId:$scope.user.id,type:"isService"},$scope.selectOptName="获取正在维修订单",$scope.selectPara="isServiceOrders",$scope.getSelectInfoApi($scope)},$scope.setIsServiceStyle=function(){var deferred=$q.defer(),liHeight=55*$scope.isServiceOrders.length+"px";return $scope.isServiceOrders.length>=3&&(liHeight="165px"),$scope.isServiceLiStyle={height:liHeight},deferred.resolve(),deferred.promise},$scope.getIncompleteOrders=function(){return $scope.selectUrl="getWarrantyNumberIsServiceListByUserId",$scope.selectParams={userId:$scope.user.id,type:"incompleteOrders"},$scope.selectOptName="获取正在进行的订单",$scope.selectPara="incompleteOrders",$scope.getSelectInfoApi($scope)},$scope.setIncompleteOrdersStyle=function(){var deferred=$q.defer(),liHeight=75*$scope.incompleteOrders.length+5+"px";return $scope.incompleteOrders.length>=3&&(liHeight="225px"),$scope.incompleteLiStyle={height:liHeight},angular.forEach($scope.incompleteOrders,function(incompleteOrder){$scope["incompleteStyle"+incompleteOrder.id]={thisIncompleteStyle:{width:incompleteOrder.maintenanceRecord.maintenanceStatus.percent.toString()}}}),deferred.resolve(),deferred.promise},$scope.initData=function(scope){var userInfoStr=localStorage.getItem("com.logistics.user.info"),userInfo=JSON.parse(userInfoStr);scope.user={id:userInfo.id,role:userInfo.role},$q.all([scope.getIncompleteOrders()]).then(function(){return scope.setIncompleteOrdersStyle()}).then(function(){return scope.getIsServiceInfo()}).then(function(){scope.setIsServiceStyle()})},$scope.loginStatus&&$scope.initData($scope),$scope.dutyList=function(id,name,type){localStorage.setItem("com.logistics.duty.departmentSelectedId",id),localStorage.setItem("com.logistics.duty.dutyShowDepartmentName",name);var maintenanceTypeID="";type&&(maintenanceTypeID=$scope.loginUser.maintenanceTypeID),localStorage.setItem("com.logistics.duty.dutyShowMaintenanceTypeID",maintenanceTypeID),$state.go("dutyDetail",{id:id,type:type})}}function carouselNewsController($scope,$http,$compile,$location,$filter,$timeout,$stateParams,$q,$sce){$scope.width=slideImageWidth,$scope.height=slideImageHeight,$scope.url="getInforSlideList",$scope.params={"searchObj[homeShow]":1,pageSize:10,start:0,pageNumber:1,"order[name]":"addDateTime","order[dir]":"desc"},$http({method:"POST",url:$scope.httpDomain+$scope.url,params:$scope.params}).success(function(data){$scope.carouselPic=data.data,$scope.firstCarouseurl=[],angular.forEach($scope.carouselPic,function(value){$scope.firstCarouseurl.push(value.url)}),$scope.carouselPic?($scope.carouselPic.length<2&&$scope.carouselPic.push({slidePicture:"./images/carousel/news1.jpg",title:"服务后勤"},{slidePicture:"./images/carousel/news2.jpg",title:"数字后勤文化后勤"}),$scope.firstTitle=$scope.carouselPic[0].title,$scope.showCarouse=!0):$scope.showCarouse=!1}),$scope.shutterInit=function(){var width=$("#carouselDom").width();$("#shutter1").shutter({shutterW:width,shutterH:270,isAutoPlay:!0,playInterval:3e3,curDisplay:0,fullPage:!1})},$scope.dealWithCarouseHref=function(){$("#shutter1 a").each(function(index,dom){$(dom).attr("href",$scope.firstCarouseurl[index])})},$scope.renderFinish=function(){$scope.shutterInit(),$scope.dealWithCarouseHref()}}angular.module("MetronicApp").controller("headerController",["$scope","$q","$stateParams","$state",headerController]),angular.module("MetronicApp").controller("carouselNewsController",["$scope","$http","$compile","$location","$filter","$timeout","$stateParams","$q","$sce",carouselNewsController]);
function getStatusTypeData($scope,$http,$compile,$location,$filter){$scope.statusTypeData=[{id:1,name:"显示",value:"1"},{id:2,name:"隐藏",value:"0"}]}function getStatusUseTypeData($scope,$http,$compile,$location,$filter){$scope.statusUseTypeData=[{id:1,name:"启用",value:"1"},{id:2,name:"禁用",value:"0"}]}function getSexTypeData($scope,$http,$compile,$location,$filter){$scope.sexTypeData=[{id:1,name:"男",value:"1"},{id:2,name:"女",value:"0"}]}function getPositionStatusData($scope,$http,$compile,$location,$filter){$scope.positionStatusData=[{id:1,name:"在职",value:"1"},{id:2,name:"离职",value:"0"}]}function getStudentStatusData($scope,$http,$compile,$location,$filter){$scope.studentStatusData=[{id:1,name:"在校",value:"1"},{id:2,name:"离校",value:"0"}]}function getLostFoundStatusData($scope,$http,$compile,$location,$filter){$scope.lostFoundStatusData=[{id:1,name:"失物",value:"1"},{id:2,name:"招领",value:"0"}]}function getFleaMarketStatusData($scope,$http,$compile,$location,$filter){$scope.fleaMarketStatusData=[{id:1,name:"出售",value:"1"},{id:2,name:"求购",value:"0"}]}function getApprovalStatusData($scope,$http,$compile,$location,$filter){return $scope.approvalStatusData=[{id:1,name:"通过审核",value:"1"},{id:2,name:"未通过审核",value:"0"}]}function getShowStatusData($scope,$http,$compile,$location,$filter){$scope.showStatusData=[{id:1,name:"是",value:"1"},{id:2,name:"否",value:"0"}]}function getCampusSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getCampusSelectList",$scope.selectOptName="获取校区信息",$scope.selectPara="campusSelectData",$scope.getSelectInfoApi($scope);$scope.campusSelectData=[{name:"校区1",id:1},{name:"校区2",id:2},{name:"校区3",id:3},{name:"校区4",id:4}]}function getDepartmentSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getDepartmentSelectList",$scope.selectOptName="获取部门信息",$scope.selectPara="departmentSelectData",$scope.getSelectInfoApi($scope);$scope.departmentSelectData=[{name:"部门1",id:0},{name:"部门2",id:1},{name:"部门3",id:2},{name:"部门4",id:3}]}function getMaintenanceTypeSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaintenanceTypeSelectList",$scope.selectOptName="获取维修工种信息",$scope.selectPara="maintenanceTypeSelectData",$scope.getSelectInfoApi($scope);$scope.maintenanceTypeSelectData=[{name:"水",id:12},{name:"电",id:23},{name:"木",id:34}]}function getMaintenanceCategorySelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaintenanceCateaorySelectList",$scope.selectOptName="获取维修类别信息",$scope.selectPara="maintenanceCategorySelectData",$scope.getSelectInfoApi($scope);$scope.maintenanceCategorySelectData=[{name:"下水疏通类",maintenanceType:{name:"水",id:1}},{name:"线路维修类",maintenanceType:{name:"电",id:2}},{name:"木",maintenanceType:{name:"木",id:3}}]}function getWorkerSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaintenanceWorkerSelectList",$scope.selectOptName="获取维修人员信息",$scope.selectPara="workerSelectData",$scope.getSelectInfoApi($scope);$scope.workerSelectData=[{name:"张三",id:1,maintenanceType:{name:"水",id:1}},{name:"李四",id:2,maintenanceType:{name:"水",id:1}},{name:"王五",id:3,maintenanceType:{name:"电",id:2}}]}function getPositionSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getPositionSelectList",$scope.selectOptName="获取职务信息",$scope.selectPara="positionSelectData",$scope.getSelectInfoApi($scope);$scope.positionSelectData=[{name:"校长",id:1},{name:"院长",id:2},{name:"系主任",id:3},{name:"部长",id:4}]}function getMaterialUnitSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaterialUnitSelectList",$scope.selectOptName="获取物料单位信息",$scope.selectPara="materialUnitSelectData",$scope.getSelectInfoApi($scope);$scope.materialUnitSelectData=[{name:"物料单位1",id:1},{name:"物料单位2",id:2},{name:"物料单位3",id:3},{name:"物料单位4",id:4}]}function getMaterialCategorySelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaterialCategorySelectList",$scope.selectOptName="获取物料类别信息",$scope.selectPara="materialCategorySelectData",$scope.getSelectInfoApi($scope);$scope.materialCategorySelectData=[{name:"物料类别1",id:1},{name:"物料类别2",id:2},{name:"物料类别3",id:3},{name:"物料类别4",id:4},{name:"物料类别5",id:5}]}function getMaterialSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaterialSelectList",$scope.selectOptName="获取物料信息",$scope.selectPara="materialSelectData",$scope.getSelectInfoApi($scope);$scope.materialSelectData=[{name:"物料1",id:1},{name:"物料2",id:2},{name:"物料3",id:3},{name:"物料4",id:4}]}function getWarrantyNumberSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getWarrantyNumberSelectList",$scope.selectOptName="获取维修单号信息",$scope.selectPara="warrantyNumberSelectData",$scope.getSelectInfoApi($scope);$scope.warrantyNumberSelectData=[{maintenanceNumber:"维修单号1",id:1},{maintenanceNumber:"维修单号2",id:2},{maintenanceNumber:"维修单号3",id:3},{maintenanceNumber:"维修单号4",id:4}]}function getInforModuleSelectData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getInforModuleSelectList",$scope.selectOptName="获取模块信息信息",$scope.selectPara="inforModulelSelectData",$scope.getSelectInfoApi($scope);$scope.inforModulelSelectData=[{name:"模块名称1",id:7},{name:"模块名称2",id:8},{name:"模块名称3",id:9},{name:"模块名称4",id:10}]}function getFinishedSelectData($scope,$http,$compile,$location,$filter){$scope.finishedlSelectData=[{name:"已完成",id:1},{name:"未完成",id:2}]}function getMaintenanceAreaData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getMaintenanceAreaSelectList",$scope.selectOptName="获取维修区域信息",$scope.selectPara="maintenanceAreaData",$scope.getSelectInfoApi($scope);$scope.maintenanceAreaData=[{name:"维修区域1",id:1},{name:"维修区域2",id:2},{name:"维修区域3",id:3},{name:"维修区域4",id:4}]}function getDutyTimeData($scope,$http,$compile,$location,$filter){$scope.dutyTimeData=[{name:"全天",id:1,value:"0"},{name:"白班",id:2,value:"1"},{name:"夜班",id:3,value:"2"}]}function getRepairStatusData($scope,$http,$compile,$location,$filter){$scope.repairStatusData=[{name:"好评",id:1,value:"1"},{name:"中评",id:2,value:"2"},{name:"差评",id:0,value:"0"}]}function getMaintenanceStatusData($scope,$http,$compile,$location,$filter){if($scope.ifOpenApi)return $scope.selectUrl="getAllMaintenanceStatus",$scope.selectOptName="获取维修状态信息",$scope.selectPara="maintenanceStatusData",$scope.getSelectInfoApi($scope);$scope.maintenanceAreaData=[{name:"待审核",id:1},{name:"待受理",id:2},{name:"待派工",id:3},{name:"待完工",id:4},{name:"维修中",id:5},{name:"已完工",id:6},{name:"已回访",id:7},{name:"已维修",id:8},{name:"未验收",id:9},{name:"锁定",id:10}]}function subDateStr(dateStr){return dateStr.substring(0,10)}function subHourStr(dateStr){return dateStr.substring(10,16)}function priceConfig(){$("#price").TouchSpin({min:0,max:1e4,step:1,decimals:0,postfix:"¥"}),$("#price2").TouchSpin({min:0,max:1e4,step:.01,decimals:2,postfix:"¥"})}function getRegisterTypesData($scope,$http,$compile,$location,$filter){$scope.registerTypesData=[{id:3,name:"在校学生",value:"3"},{id:1,name:"维修工人",value:"1"},{id:2,name:"教职人员",value:"2"}]}
var dataTables=function(){var initTable=function($scope,$http,$compile,$location,$filter){var table;(table=$scope.initDataTablesName?$("#"+$scope.initDataTablesName):$("#dataTable")).dataTable($.extend({language:{aria:{sortAscending:": 以升序排列此列",sortDescending:": 以降序排列此列"},emptyTable:"没有查询出数据",info:"显示 _START_ 至 _END_ 项结果 , 总共 _TOTAL_ 条数据",infoEmpty:"",infoFiltered:"(由 _MAX_ 项结果过滤)",lengthMenu:"选择分页 : _MENU_",search:"查询 :",zeroRecords:"没有匹配结果",paginate:{previous:"上一页",next:"下一页",last:"末页",first:"首页"}},serverSide:!0,ajax:function(data,callback,settings){$scope.addLoading();try{var param={};param.pageSize=data.length,param.start=data.start,param.pageNumber=data.start/data.length+1,param.order={};var orderObj=data.order[0];param.order.dir=orderObj.dir,param.order.name=data.columns[orderObj.column].data,param.searchObj=void 0==$scope.searchObj?"":$scope.searchObj,$.ajax({type:"POST",url:void 0!=$scope.url&&$scope.ifOpenApi?$scope.httpDomain+$scope.url:"demo/"+$scope.controllerName+".json",cache:!1,data:param,dataType:"json",headers:{"logistics-session-token":$scope.getToken()},success:function(result){var returnData={};returnData.draw=data.draw,returnData.data=result.data,returnData.recordsTotal=result.total,returnData.recordsFiltered=returnData.recordsTotal,returnData.data&&callback(returnData),$scope.removeLoading()},error:function(){$scope.removeLoading()}})}catch(e){$scope.removeLoading()}},columns:$scope.columns,bLengthChange:!1,bPaginate:!0,bStateSave:!1,searching:!1,lengthMenu:[[10,20,-1],[10,20,"全部"]],pageLength:10,pagingType:"bootstrap_full_number",columnDefs:[{orderable:!1,targets:$scope.orderableAry},{targets:$scope.redirectionNewPage,data:null,render:function(data,display,row){data=translateSingleQuotes(data);var viewOptHtml="<a ui-sref="+$scope.redirectUrl+"({id:"+row.id+"})>"+data+"</a>";return $scope.getWrapHtml(data,viewOptHtml)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.viewNewsAry,data:null,render:function(data,display,row){data=translateSingleQuotes(data);var viewOptHtml="<a ui-sref='viewNews({id:"+row.id+"})'>"+data+"</a>";return $scope.getWrapHtmlWithSpecified(data,viewOptHtml,"top","550")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.viewCommonRepairAry,data:null,render:function(data,display,row){data=translateSingleQuotes(data);var viewOptHtml="<a ui-sref='viewMyRepair({id:"+row.id+"})'>"+data+"</a>";return $scope.getWrapHtml(data,viewOptHtml,"350")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.viewMyRepairAry,data:null,render:function(data,display,row){if(row.warrantyNumber.maintenanceRecord){data=translateSingleQuotes(data);viewOptHtml="<a ui-sref='viewMyRepair({id:"+row.warrantyNumber.id+"})'>"+data+"</a>"}else{data=translateSingleQuotes(data);var viewOptHtml="<a ui-sref='specialRepairView({id:"+row.warrantyNumber.id+"})'>"+data+"</a>"}return $scope.getWrapHtml(data,viewOptHtml,"350")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.viewSpecialRepairAry,data:null,render:function(data,display,row){data=translateSingleQuotes(data);var viewOptHtml="<a ui-sref='specialRepairView({id:"+row.id+"})'>"+data+"</a>";return $scope.getWrapHtml(data,viewOptHtml,"150")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.viewMaterialAry,data:null,render:function(data,display,row){data=translateSingleQuotes(data);var viewOptHtml="<a ui-sref='materialView({id:"+row.id+"})'>"+data+"</a>";return $scope.getWrapHtml(data,viewOptHtml,"250")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.viewMyMaterialAry,data:null,render:function(data,display,row){data=translateSingleQuotes(data);var viewOptHtml="<a ui-sref='materialView({id:"+row.material.id+"})'>"+data+"</a>";return $scope.getWrapHtml(data,viewOptHtml,"250")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.viewFleaMarketAry,data:null,render:function(data,display,row){data=translateSingleQuotes(data);var viewOptHtml="<a ui-sref='viewFleaMarket({id:"+row.id+"})'>"+data+"</a>";return $scope.getWrapHtml(data,viewOptHtml,"380")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.viewLostFoundAry,data:null,render:function(data,display,row){data=translateSingleQuotes(data);var viewOptHtml="<a ui-sref='viewLostFound({id:"+row.id+"})'>"+data+"</a>";return $scope.getWrapHtml(data,viewOptHtml,"500")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.viewWorkLogAry,data:null,render:function(data,display,row){data=translateSingleQuotes(data);var viewOptHtml="<a ui-sref='workLogView({id:"+row.id+"})'>"+data+"</a>";return $scope.getWrapHtml(data,viewOptHtml,"500")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.trueOrFalse,data:null,render:function(data){return"1"==data?"是":"否"}},{targets:$scope.htmlType,data:null,render:function(data){return $("<span/>").text(data).html()}},{targets:$scope.inforType,data:null,render:function(data){return"1"==data?"图文类型":"文本类型"}},{targets:$scope.sexType,data:null,render:function(data){return"1"==data?"男":"女"}},{targets:$scope.ifDoneType,data:null,render:function(data){return"1"==data?"已完成":"未完成"}},{targets:$scope.repairType,data:null,render:function(data){return"1"==data?"微信报修":"网页报修"}},{targets:$scope.dateFormatAry,data:null,render:function(data){return subDateStr(data)}},{targets:$scope.dateFormatMonthDay,data:null,render:function(data){return subDateStr(data)}},{targets:$scope.dateFormatHourDay,data:null,render:function(data){return subHourStr(data)}},{targets:$scope.releaseType,data:null,render:function(data){return"1"==data?"已发布":"待发布"}},{targets:$scope.fleaMarketType,data:null,render:function(data){return"1"==data?"出售":"求购"}},{targets:$scope.lostFoundType,data:null,render:function(data){return"1"==data?"失物":"招领"}},{targets:$scope.nullStr,data:null,render:function(data){return null==data?"":data}},{targets:$scope.wrapAry,data:null,render:function(data){return $scope.getWrapHtml(data,data,"200")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.wrapShortAry,data:null,render:function(data){return $scope.getWrapHtml(data,data,"100")},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.urlAry,data:null,render:function(data){return $scope.getUrlHtml(data,data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.dealStatus,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"dealStatus",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.switchStatus,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"status",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.switchSlideShow,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"slideShow",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.switchHomeShow,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"homeShow",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.switchWorkStatus,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"workStatus",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.approvalStatus,data:null,render:function(data,display,row){return $scope.getStatusHtml($scope,row.id,"approvalStatus",data)},fnCreatedCell:function(nTd){$compile(nTd)($scope)}},{targets:$scope.targetsOpt,data:null,render:function(data,dispaly,row){var params=JSON.stringify(data).replace(/\'/g,"&apos;"),editName=void 0==$scope.editName?"修改":$scope.editName,detailOptHtml="<a data-microtip='详情' data-microtip-position='top' class='btn btn-xs green-haze showDetailOpt' data-toggle='modal'><i class='fa fa-file-o'></i></a>";if(row.approvalStatus)var editFleaMarketOptHtml="<a ng-disabled='true' data-microtip='修改' data-microtip-position='top' class='btn btn-xs blue' data-toggle='modal'><i class='fa fa-edit'></i></a>",editLostFoundOptHtml="<a ng-disabled='true' data-microtip='修改' data-microtip-position='top' class='btn btn-xs blue' data-toggle='modal'><i class='fa fa-edit'></i></a>";else if(row.type)var editFleaMarketOptHtml="<a data-microtip='修改' data-microtip-position='top' ui-sref='fleaMarketAddSale({id:"+row.id+",type:"+row.type+"})' class='btn btn-xs blue' data-toggle='modal'><i class='fa fa-edit'></i></a>",editLostFoundOptHtml="<a data-microtip='修改' data-microtip-position='top' ui-sref='lostAdd({id:"+row.id+",type:"+row.type+"})' class='btn btn-xs blue' data-toggle='modal'><i class='fa fa-edit'></i></a>";else var editFleaMarketOptHtml="<a data-microtip='修改' data-microtip-position='top' ui-sref='fleaMarketAddPurchase({id:"+row.id+",type:"+row.type+"})' class='btn btn-xs blue' data-toggle='modal'><i class='fa fa-edit'></i></a>",editLostFoundOptHtml="<a data-microtip='修改' data-microtip-position='top' ui-sref='foundAdd({id:"+row.id+",type:"+row.type+"})' class='btn btn-xs blue' data-toggle='modal'><i class='fa fa-edit'></i></a>";var removeOptHtml="<a data-microtip='删除' data-microtip-position='top' ng-click='removeModal("+data.id+")' class='btn btn-xs red' data-toggle='modal'><i class='fa fa-times'></i></a>",previewOptHtml="<a data-microtip='预览' data-microtip-position='top' ng-click='preview("+data.id+")' class='btn btn-xs purple-sharp' data-toggle='modal'><i class='fa fa-link'></i></a>";if(row.maintenanceRecord&&5===row.maintenanceRecord.maintenanceStatus.id)var commentOptHtml="<a data-microtip='评价' data-microtip-position='top' ng-click='commentModal("+data.id+")' class='btn btn-xs red-haze' data-toggle='modal'><i class='fa fa-comments'></i></a>";else var commentOptHtml="<a ng-disabled='true' data-microtip='评价' data-microtip-position='top' class='btn btn-xs red-haze' data-toggle='modal'><i class='fa fa-comments'></i></a>";var printOptHtml="<a data-microtip='打印预览' data-microtip-position='top' ng-click='print("+data.id+")' class='btn btn-xs yellow' data-toggle='modal'><i class='fa fa-print'></i></a>",resetPswOptHtml="<a data-microtip='重置密码' data-microtip-position='top' ng-click='resetPswModal("+data.id+")' class='btn btn-xs yellow' data-toggle='modal'><i class='fa fa-lock'></i></a>",dutyListOptHtml="<a data-microtip='值班安排' data-microtip-position='top' ng-click='dutyList("+data.id+',"'+data.name+"\",0)' class='btn btn-xs green-haze' data-toggle='modal'><i class='fa fa-file-o'></i></a>",html="";return angular.forEach($scope.optHtmlAry,function(value,key){html+=eval(value+"OptHtml")}),html},fnCreatedCell:function(nTd){$compile(nTd)($scope)}}],responsive:{details:{type:"column",target:"td>.showDetailOpt"}},destroy:!0,order:$scope.order,fnDrawCallback:function(){this.api().column(0).nodes().each(function(cell,i){cell.innerHTML=i+1}),$(".make-switch").bootstrapSwitch()}},$scope.scroll))},translateSingleQuotes=function(data){return JSON.parse(JSON.stringify(data).replace(/\'/g,"&apos;"))};return{init:function($scope,$http,$compile,$location,$filter){jQuery().dataTable&&initTable($scope,$http,$compile,$location,$filter)}}}();
var datePickers=function(){var initDatePicker=function($scope,$http,$compile,$location,$filter){var commonOptions={autoclose:!0,isRTL:App.isRTL(),pickerPosition:App.isRTL()?"bottom-right":"bottom-left",todayBtn:!0,language:"zh-CN",todayHighlight:!0},option=$.extend(commonOptions,$scope.option);$(".form_datetime").datetimepicker(option),$("body").removeClass("modal-open")},initFormDatePicker=function($scope,$http,$compile,$location,$filter){var commonOptions={autoclose:!0,isRTL:App.isRTL(),pickerPosition:App.isRTL()?"bottom-right":"bottom-left",todayBtn:!0,language:"zh-CN",todayHighlight:!0},option=$.extend(commonOptions,$scope.option);angular.forEach($scope.datetimepickerId,function(id){$("#"+id+"StartDateTime").datetimepicker(option).on("changeDate",function(ev){$("#"+id+"EndDateTime").datetimepicker("setStartDate",$scope.data[id+"StartDateTime"]),$("#"+id+"StartDateTime").datetimepicker("hide")}),$("#"+id+"EndDateTime").datetimepicker(option).on("changeDate",function(ev){$("#"+id+"StartDateTime").datetimepicker("setEndDate",$scope.data[id+"EndDateTime"]),$("#"+id+"EndDateTime").datetimepicker("hide")})}),$("body").removeClass("modal-open")},initSearchDatePicker=function($scope,$http,$compile,$location,$filter){var option={isRTL:App.isRTL(),pickerPosition:App.isRTL()?"bottom-right":"bottom-left",format:"yyyy-mm-dd",todayHighlight:!0,language:"zh-CN",autoclose:!0,minView:2};angular.forEach($scope.datetimepickerId,function(id){$("#"+id+"Start").datetimepicker(option).on("changeDate",function(ev){$("#"+id+"End").datetimepicker("setStartDate",$scope.searchObj[id+"Start"]),$("#"+id+"Start").datetimepicker("hide")}),$("#"+id+"End").datetimepicker(option).on("changeDate",function(ev){$("#"+id+"Start").datetimepicker("setEndDate",$scope.searchObj[id+"End"]),$("#"+id+"End").datetimepicker("hide")})}),$("body").removeClass("modal-open")};return{init:function($scope,$http,$compile,$location,$filter){1==$scope.searchInit?initSearchDatePicker($scope):1==$scope.formInit?initFormDatePicker($scope):initDatePicker($scope)}}}(),timePickers=function(){var initFormTimePicker=function($scope,$http,$compile,$location,$filter){var commonOptions={autoclose:!0,language:"zh-CN",format:"hh:ii",startView:1,minView:0,maxView:0,keyboardNavigation:!1,showMeridian:!0,initialDate:new Date,maxDate:"23:55",minDate:"00:00"},option=$.extend(commonOptions,$scope.option);angular.forEach($scope.timepickerId,function(id){$("#"+id+"Start").datetimepicker(option),$("#"+id+"End").datetimepicker(option)}),$("body").removeClass("modal-open")};return{init:function($scope,$http,$compile,$location,$filter){1==$scope.formInitTime&&initFormTimePicker($scope)}}}();
var Upload=function(){var init=function(scope,timeout){$("#uploadImg").zyUpload({width:"100%",height:"100%",itemWidth:"118px",itemHeight:"100px",url:scope.httpDomain+"summernote/fileupload",multiple:!0,dragDrop:!0,del:!0,finishDel:!1},null,scope,timeout)};return{init:function(scope,timeout){init(scope,timeout)}}}();
var editors=function(){var handleSummernote=function($scope){function sendFile(files,editor,$editable){$scope.addLoading();var data=new FormData;data.append("ajaxTaskFile",files[0]),$.ajax({data:data,type:"POST",url:$scope.httpDomain+$scope.uploadUrl,cache:!1,contentType:!1,processData:!1,dataType:"json",success:function(data){"SUCCESS"===data.message?($("#summernote").summernote("insertImage",data.url),sweetAlert("提示","图片添加成功！","success")):sweetAlert("警告","图片添加失败！","error"),$scope.removeLoading()},error:function(){sweetAlert("警告","图片添加失败！","error"),$scope.removeLoading()}})}$("#summernote").summernote({height:400,lang:"zh-CN",focus:!0,toolbar:[["style",["style"]],["font",["bold","underline","clear"]],["fontname",["fontname"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link","picture"]]],callbacks:{onImageUpload:function(files,editor,$editable){sendFile(files)}}})};return{init:function($scope){handleSummernote($scope)}}}();
function getWeek(dateString){var date;if(isNull(dateString))date=new Date;else{var dateArray=dateString.split("-");date=new Date(dateArray[0],parseInt(dateArray[1]-1),dateArray[2])}return"周"+"日一二三四五六".charAt(date.getDay())}Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in o)new RegExp("("+k+")").test(fmt)&&(fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return fmt},$(function(){setInterval(function(){var year=(date=new Date).getFullYear(),month=date.getMonth()+1,day=date.getDate(),hours=date.getHours(),minutes=date.getMinutes(),seconds=date.getSeconds(),date=date.getDate(),t=year+"年"+month+"月"+day+"日 "+(hours=hours>=10?hours:"0"+hours)+":"+(minutes=minutes>=10?minutes:"0"+minutes)+":"+(seconds=seconds>=10?seconds:"0"+seconds);$("#clock").html(t)},1e3)});var dateUtil=function(){function isNull(object){return null==object||void 0===object}return{getWeekStr:function(dateString){var date;if(isNull(dateString))date=new Date;else{var dateArray=dateString.split("-");date=new Date(dateArray[0],parseInt(dateArray[1]-1),dateArray[2])}return"周"+"日一二三四五六".charAt(date.getDay())}}}();
var calendar=function(){var initCalendar=function(){var date=new Date;date.getDate(),date.getMonth(),date.getFullYear();$("#calendar").fullCalendar({lang:"zh-cn",header:{left:"prev,next today",center:"title",right:"month,agendaWeek,agendaDay"},weekends:!0,events:function(start,end,timezone,callback){var date=this.getDate().format("YYYY-MM");$.ajax({url:"demo/duty.json",dataType:"json",data:{date:date},success:function(json){var events=[];$.each(json.data,function(i,c){events.push({title:c.title,start:c.start,end:c.end,color:c.color,id:c.id})}),callback(events)}})},dayClick:function(date,jsEvent,view){$("#calendar").fullCalendar("clientEvents",function(event){var eventStart=event.start.format("YYYY-MM-DD"),eventEnd=event.end?event.end.format("YYYY-MM-DD"):null,theDate=date.format("YYYY-MM-DD");return eventStart<=theDate&&eventEnd>=theDate&&!(eventStart<theDate&&eventEnd==theDate)||eventStart==theDate&&null===eventEnd})}})},initRegisterCalendar=function(scope){$("#calendar").fullCalendar({lang:"zh-cn",header:{left:"prev,next",center:"title",right:"today"},weekends:!0,selectable:!0,unselectAuto:!1,events:function(start,end,timezone,callback){var _year=new Date(this.getDate()).Format("yyyy"),_month=new Date(this.getDate()).Format("MM"),checkedDateList=localStorage.getItem("com.logistics.duty.checkedDateList"),checkedYearMonth=localStorage.getItem("com.logistics.duty.checkedYearMonth");checkedYearMonth&&"null"!==checkedYearMonth&&("true"==localStorage.getItem("com.logistics.duty.callbackToFirst")?(this.gotoDate(new Date(checkedYearMonth+"-01")),localStorage.setItem("com.logistics.duty.callbackToFirst",!1)):(localStorage.removeItem("com.logistics.duty.checkedDateList"),localStorage.removeItem("com.logistics.duty.checkedYearMonth"),_year+"-"+_month!==checkedYearMonth?checkedDateList=null:(_year=checkedYearMonth.substring(0,4),_month=checkedYearMonth.substring(5,7)))),scope.addLoading(),$.ajax({url:scope.httpDomain+scope.url,dataType:"json",type:"POST",data:{year:_year,month:_month},headers:{"logistics-session-token":scope.getToken()},success:function(json){$("td.fc-day").addClass("calendarTableDone"),scope.holidayDate=json.data,localStorage.setItem("com.logistics.duty.AllHolidayFromDate",JSON.stringify(scope.holidayDate));var events=[];if($.each(json.data,function(i,c){events.push({title:c.title,start:c.start,end:c.end,backgroundColor:"2"==c.type?"#E7505A":"#36D7B7"}),null!==checkedDateList&&"null"!==checkedDateList||initFalseDateAndIcon(c.start,!1)}),checkedDateList&&"null"!==checkedDateList){var allDays=getDaysInMonth(_year,_month);checkedDateList.split(",").forEach(function(date){allDays.splice($.inArray(date,allDays),1)}),allDays.forEach(function(date){initFalseDateAndIcon(date,!1)})}$("td.fc-today.fc-state-highlight.calendarTableDone").append(todayImgStr),$("td.fc-day-number.fc-today.fc-state-highlight").removeClass().addClass("calendarTodayBar"),callback(events),changeDisableTbClass(),getCheckedDate(scope),$("td.fc-day.calendarTableDone:not(.calendarTableDisabled,.calendarTableFalse)").append(trueImgStr),checkedDateList&&"null"!==checkedDateList&&$("td.fc-day.fc-today").removeClass("fc-today"),scope.removeLoading()},error:function(){scope.removeLoading(),sweetAlert("警告","获取失败,请重试!","error")}})},dayClick:function(date,jsEvent,view){$(this).hasClass("calendarTableFalse")?($(this).removeClass("calendarTableFalse"),$(this).children("img.calendarTipImg").remove(),$(this).append(trueImgStr),getCheckedDate(scope)):$(this).hasClass("calendarTableDisabled")||($(this).hasClass("fc-today")?$(this).removeClass("fc-today").addClass("calendarTableFalse"):$(this).addClass("calendarTableFalse"),$(this).append(falseImgStr),getCheckedDate(scope));$("#calendar").fullCalendar("clientEvents",function(event){var eventStart=event.start.format("YYYY-MM-DD"),eventEnd=event.end?event.end.format("YYYY-MM-DD"):null,theDate=date.format("YYYY-MM-DD");return eventStart<=theDate&&eventEnd>=theDate&&!(eventStart<theDate&&eventEnd==theDate)||eventStart==theDate&&null===eventEnd})}})},initAutoDuty=function(){$("#calendar").fullCalendar({lang:"zh-cn",header:{left:"",center:"title",right:""},weekends:!0,eventOrder:["-backgroundColor","-color"],events:function(start,end,timezone,callback){var checkedYearMonth=localStorage.getItem("com.logistics.duty.checkedYearMonth");checkedYearMonth&&"null"!==checkedYearMonth&&this.gotoDate(new Date(checkedYearMonth+"-01").Format("yyyy-MM"));var _year=checkedYearMonth.substring(0,4),_month=checkedYearMonth.substring(5,7),checkedDateList=localStorage.getItem("com.logistics.duty.checkedDateList");if($("td.fc-day").addClass("calendarTableDone"),checkedDateList&&"null"!==checkedDateList){var allDays=getDaysInMonth(_year,_month);checkedDateList.split(",").forEach(function(date){allDays.splice($.inArray(date,allDays),1)}),allDays.forEach(function(date){initFalseDateAndIcon(date,!0)})}$("td.fc-day-number.fc-today.fc-state-highlight").removeClass().addClass("calendarTodayBar"),checkedDateList&&"null"!==checkedDateList&&$("td.fc-day.fc-today").removeClass("fc-today"),changeDisableTbClass()}})},initManualDuty=function(scope){$("#calendar").fullCalendar({lang:"zh-cn",header:{left:"",center:"title",right:""},weekends:!0,eventOrder:["-backgroundColor","-color"],editable:!0,eventStartEditable:!0,eventDurationEditable:!1,dragOpacity:{agenda:.5,"":.6},eventDrop:function(event,delta,revertFunc,jsEvent,ui,view){localStorage.getItem("com.logistics.duty.checkedDateList"),eventDropAllow(scope,event,delta)?scope.select.isSelected&&moveOriginalEventToStartDate(scope):revertFunc()},events:function(start,end,timezone,callback){var checkedYearMonth=localStorage.getItem("com.logistics.duty.checkedYearMonth");checkedYearMonth&&"null"!==checkedYearMonth&&this.gotoDate(new Date(checkedYearMonth+"-01").Format("yyyy-MM"));var _year=checkedYearMonth.substring(0,4),_month=checkedYearMonth.substring(5,7),checkedDateList=localStorage.getItem("com.logistics.duty.checkedDateList");if($("td.fc-day").addClass("calendarTableDone"),checkedDateList&&"null"!==checkedDateList){var allDays=getDaysInMonth(_year,_month);checkedDateList.split(",").forEach(function(date){allDays.splice($.inArray(date,allDays),1)}),allDays.forEach(function(date){initFalseDateAndIcon(date,!0)})}$("td.fc-day-number.fc-today.fc-state-highlight").removeClass().addClass("calendarTodayBar"),checkedDateList&&"null"!==checkedDateList&&$("td.fc-day.fc-today").removeClass("fc-today"),changeDisableTbClass(),callback(scope.events)}})},initLastDuty=function(scope){$("#calendar").fullCalendar({lang:"zh-cn",header:{left:"",center:"title",right:""},weekends:!0,eventOrder:["-backgroundColor","-color"],events:function(start,end,timezone,callback){var checkedYearMonth=localStorage.getItem("com.logistics.duty.checkedYearMonth");checkedYearMonth&&"null"!==checkedYearMonth&&this.gotoDate(new Date(checkedYearMonth+"-01").Format("yyyy-MM"));var _year=checkedYearMonth.substring(0,4),_month=checkedYearMonth.substring(5,7),checkedDateList=localStorage.getItem("com.logistics.duty.checkedDateList");if($("td.fc-day").addClass("calendarTableDone"),checkedDateList&&"null"!==checkedDateList){var allDays=getDaysInMonth(_year,_month);checkedDateList.split(",").forEach(function(date){allDays.splice($.inArray(date,allDays),1)}),allDays.forEach(function(date){initFalseDateAndIcon(date,!0)})}$("td.fc-day-number.fc-today.fc-state-highlight").removeClass().addClass("calendarTodayBar"),checkedDateList&&"null"!==checkedDateList&&$("td.fc-day.fc-today").removeClass("fc-today"),changeDisableTbClass(),callback(scope.events)}})},changeDisableTbClass=function(){$("td.fc-other-month").addClass("calendarTableDisabled").children("img").remove()},getCheckedDate=function(scope){var checkedDate=[];$("td.fc-day.calendarTableDone:not(.calendarTableDisabled,.calendarTableFalse)").each(function(){checkedDate.push($(this).attr("data-date"))}),scope.$apply(function(){scope.checkedDayList=checkedDate})},initFalseDateAndIcon=function(date,flag){var _td=$('td[data-date="'+date+'"].calendarTableDone');_td.addClass("calendarTableFalse"),_td.remove("img"),flag||_td.append(falseImgStr)},getDaysInMonth=function(year,month){for(var allDay=new Date(year,month,0).getDate(),returnDateList=[],i=1;i<=allDay;i++)returnDateList.push(new Date(year,month-1,i).Format("yyyy-MM-dd"));return returnDateList},eventDropAllow=function(scope,event,delta){var dayFlag=event.id.split("#")[2],startDate=getStartDateFromId(scope,event.id),endDate=scope.getNextDayStr(startDate,delta._days),checkedDateList=scope.checkedDateList;if($.inArray(endDate,checkedDateList)<0)return!1;var firstId;return angular.forEach(scope.events,function(_event){event.id==_event.id&&(firstId=event.id,scope.$apply(function(){_event.start=endDate,_event.end=scope.getNextDayStr(endDate)}))}),angular.forEach(scope.events,function(_event){_event.start==endDate&&_event.id!=firstId&&-1!==_event.id.indexOf(dayFlag)&&scope.$apply(function(){scope.reloadCalendarId=_event.id,scope.reloadCalendarEnd=startDate})}),!0},moveOriginalEventToStartDate=function(scope){angular.forEach(scope.events,function(_event){_event.id==scope.reloadCalendarId&&scope.$apply(function(){_event.start=scope.reloadCalendarEnd,_event.end=scope.getNextDayStr(scope.reloadCalendarEnd)})}),$("#calendar").fullCalendar("destroy"),calendar.manualGenerateDuty(scope)},getStartDateFromId=function(scope,id){var result;return angular.forEach(scope.events,function(_event){_event.id==id&&(result=_event.start)}),result},commonImgStr="<img class='calendarTipImg' src='./../assets/global/img/",trueImgStr=commonImgStr+"true.png'/>",falseImgStr=commonImgStr+"false.png'/>",todayImgStr="<img class='calendarTodayImg' src='./../assets/global/img/today.png'/>";return{init:function(){initCalendar()},registerInitMonth:function(scope){initRegisterCalendar(scope)},autoGenerateDuty:function(scope){initAutoDuty()},manualGenerateDuty:function(scope){initManualDuty(scope)},showLastDuty:function(scope){initLastDuty(scope)}}}();
var commonECharts=function(scope){var commonOption={toolbox:{show:!0,x:"750px",feature:{dataView:{show:!1},restore:{show:!0},dataZoom:{show:!0},saveAsImage:{show:!0},magicType:{type:["bar","line"]}}},title:{text:"",left:"center"},legend:{left:"20%"}};return{commonLineOption:{toolbox:commonOption.toolbox,title:commonOption.title,legend:commonOption.legend,color:["#3398DB","#996666","#99CC66","#CC3333","#CC99FF","#FF9933"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{data:[],name:"x轴"},yAxis:{name:"y轴"},series:[{type:"line",smooth:!0,data:[],lineStyle:{normal:{width:1}},symbol:"circle",symbolSize:5,showSymbol:!0,smoothMonotone:"x",label:{normal:{color:"#999999",fontWeight:"bold",show:!0,position:[10,-25]}},itemStyle:{normal:{color:"rgb(0,136,212)",borderColor:"rgba(0,136,212,0.5)",borderWidth:12}}}]},commonPieOption:{toolbox:commonOption.toolbox,title:commonOption.title,color:["#2ec7c9","#b6a2de","#ffb980","#5ab1ef","#d87a80","#8d98b3","#e5cf0d"],tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"20%",data:[]},series:[{name:"",type:"pie",radius:"50%",center:["50%","40%"],data:[],itemStyle:{normal:{shadowBlur:20,shadowColor:"rgba(0, 0, 0, 0.3)",shadowOffsetY:5},emphasis:{shadowBlur:40,shadowOffsetX:0,shadowOffsetY:10,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]},postLineApi:function(myChart,scope,i,state){myChart.showLoading();var url=scope.ifOpenApi?scope.httpDomain+scope.echartUrls[i]:"demo/"+scope.demoNames[i]+".json";$.ajax({type:"POST",url:url,data:scope.params[i],dataType:"json",headers:{"logistics-session-token":scope.getToken()}}).done(function(data){scope.$apply(function(){scope.data[i]=data});var _target=$("#"+scope.echartsIds[i]);if(myChart.hideLoading(),0===data.data.length)return scope.$apply(function(){scope.noEChartsData=!0}),void _target.addClass("hide");scope.$apply(function(){scope.noEChartsData=!1}),_target.removeClass("hide"),myChart.setOption({xAxis:{data:data.categories},series:[{data:data.data}]}),window.onresize=function(){myChart.resize()},document.addEventListener&&document.addEventListener("webkitvisibilitychange",function(){"Chrome"==BrowserVersion.type&&BrowserVersion.version.split(".")[0]<<0>=62&&state.reload()})})},postPieApi:function(myChart,scope,i,state){myChart.showLoading();var url=scope.ifOpenApi?scope.httpDomain+scope.echartUrls[i]:"demo/"+scope.demoNames[i]+".json";$.ajax({type:"POST",url:url,data:scope.params[i],dataType:"json",headers:{"logistics-session-token":scope.getToken()}}).done(function(data){try{scope.$apply(function(){scope.data[i]=data});var _target=$("#"+scope.echartsIds[i]);if(0===data.data.length)return _target.addClass("hide"),scope.$apply(function(){scope.noEChartsData=!0}),void myChart.hideLoading();scope.$apply(function(){scope.noEChartsData=!1}),_target.removeClass("hide");var _legend=[];data.data.forEach(function(value){_legend.push(value.name)}),myChart.hideLoading(),myChart.setOption({series:[{data:data.data}],legend:{data:_legend}}),window.onresize=function(){myChart.resize()},document.addEventListener&&document.addEventListener("webkitvisibilitychange",function(){"Chrome"==BrowserVersion.type&&BrowserVersion.version.split(".")[0]<<0>=62&&state.reload()})}catch(e){myChart.hideLoading()}})},init:function(scope,state){for(var i=0;i<scope.echartsIds.length;i++){var myChart=echarts.init(document.getElementById(scope.echartsIds[i])),option=void 0,echartType=scope.echartTypes[i];if("Line"===echartType||"Pie"===echartType){var _option=eval("commonECharts.common"+echartType+"Option");option=$.extend(!0,angular.copy(_option),scope.echartOptions[i]),myChart.setOption(option),eval("commonECharts.post"+echartType+"Api(myChart, scope, i, state)")}}}}}();
function PercentPie(option){this.backgroundColor=option.backgroundColor,this.color=option.color||["#38a8da","#ccc"],this.fontSize=option.fontSize||12,this.domEle=option.domEle,this.value=option.value,this.name=option.name,this.title=option.title}PercentPie.prototype.init=function(state){var _that=this,option={backgroundColor:_that.backgroundColor,color:_that.color,title:{text:_that.title,top:"3%",left:"1%",textStyle:{color:"#333",fontStyle:"normal",fontWeight:"normal",fontFamily:"sans-serif",fontSize:16}},series:[{name:"来源",type:"pie",radius:["60%","75%"],avoidLabelOverlap:!1,hoverAnimation:!0,label:{normal:{show:!1,position:"center",textStyle:{fontSize:_that.fontSize,fontWeight:"bold"},formatter:"{b}\n{c}%"}},data:[{value:_that.value,name:_that.name,label:{normal:{show:!0}}},{value:100-_that.value,name:""}]}]},myChart=echarts.init(_that.domEle);myChart.setOption(option),window.onresize=function(){myChart.resize()},document.addEventListener&&document.addEventListener("webkitvisibilitychange",function(){"Chrome"==BrowserVersion.type&&BrowserVersion.version.split(".")[0]<<0>=62&&state.reload()})};