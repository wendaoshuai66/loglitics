!function($){"use strict";var Modal=function(element,options){this.init(element,options)};Modal.prototype={constructor:Modal,init:function(element,options){var that=this;this.options=options,this.$element=$(element).delegate('[data-dismiss="modal"]',"click.dismiss.modal",$.proxy(this.hide,this)),this.options.remote&&this.$element.find(".modal-body").load(this.options.remote,function(){var e=$.Event("loaded");that.$element.trigger(e)});var manager="function"==typeof this.options.manager?this.options.manager.call(this):this.options.manager;(manager=manager.appendModal?manager:$(manager).modalmanager().data("modalmanager")).appendModal(this)},toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var e=$.Event("show");this.isShown||(this.$element.trigger(e),e.isDefaultPrevented()||(this.escape(),this.tab(),this.options.loading&&this.loading()))},hide:function(e){e&&e.preventDefault(),e=$.Event("hide"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.tab(),this.isLoading&&this.loading(),$(document).off("focusin.modal"),this.$element.removeClass("in").removeClass("animated").removeClass(this.options.attentionAnimation).removeClass("modal-overflow").attr("aria-hidden",!0),$.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},layout:function(){var prop=this.options.height?"height":"max-height",value=this.options.height||this.options.maxHeight;if(this.options.width){this.$element.css("width",this.options.width);var that=this;this.$element.css("margin-left",function(){return/%/gi.test(that.options.width)?-parseInt(that.options.width)/2+"%":-$(this).width()/2+"px"})}else this.$element.css("width",""),this.$element.css("margin-left","");this.$element.find(".modal-body").css("overflow","").css(prop,""),value&&this.$element.find(".modal-body").css("overflow","auto").css(prop,value),$(window).height()-10<this.$element.height()||this.options.modalOverflow?this.$element.css("margin-top",0).addClass("modal-overflow"):this.$element.css("margin-top",0-this.$element.height()/2).removeClass("modal-overflow")},tab:function(){var that=this;this.isShown&&this.options.consumeTab?this.$element.on("keydown.tabindex.modal","[data-tabindex]",function(e){if(e.keyCode&&9==e.keyCode){var elements=[],tabindex=Number($(this).data("tabindex"));that.$element.find("[data-tabindex]:enabled:visible:not([readonly])").each(function(ev){elements.push(Number($(this).data("tabindex")))}),elements.sort(function(a,b){return a-b});var arrayPos=$.inArray(tabindex,elements);e.shiftKey?0==arrayPos?that.$element.find("[data-tabindex="+elements[elements.length-1]+"]").focus():that.$element.find("[data-tabindex="+elements[arrayPos-1]+"]").focus():arrayPos<elements.length-1?that.$element.find("[data-tabindex="+elements[arrayPos+1]+"]").focus():that.$element.find("[data-tabindex="+elements[0]+"]").focus(),e.preventDefault()}}):this.isShown||this.$element.off("keydown.tabindex.modal")},escape:function(){var that=this;this.isShown&&this.options.keyboard?(this.$element.attr("tabindex")||this.$element.attr("tabindex",-1),this.$element.on("keyup.dismiss.modal",function(e){27==e.which&&that.hide()})):this.isShown||this.$element.off("keyup.dismiss.modal")},hideWithTransition:function(){var that=this,timeout=setTimeout(function(){that.$element.off($.support.transition.end),that.hideModal()},500);this.$element.one($.support.transition.end,function(){clearTimeout(timeout),that.hideModal()})},hideModal:function(){var prop=this.options.height?"height":"max-height";(this.options.height||this.options.maxHeight)&&this.$element.find(".modal-body").css("overflow","").css(prop,""),this.$element.hide().trigger("hidden")},removeLoading:function(){this.$loading.remove(),this.$loading=null,this.isLoading=!1},loading:function(callback){callback=callback||function(){};var animate=this.$element.hasClass("fade")?"fade":"";if(this.isLoading)if(this.isLoading&&this.$loading){this.$loading.removeClass("in");var that=this;$.support.transition&&this.$element.hasClass("fade")?this.$loading.one($.support.transition.end,function(){that.removeLoading()}):that.removeLoading()}else callback&&callback(this.isLoading);else{var doAnimate=$.support.transition&&animate;this.$loading=$('<div class="loading-mask '+animate+'">').append(this.options.spinner).appendTo(this.$element),doAnimate&&this.$loading[0].offsetWidth,this.$loading.addClass("in"),this.isLoading=!0,doAnimate?this.$loading.one($.support.transition.end,callback):callback()}},focus:function(){var $focusElem=this.$element.find(this.options.focusOn);($focusElem=$focusElem.length?$focusElem:this.$element).focus()},attention:function(){if(this.options.attentionAnimation){this.$element.removeClass("animated").removeClass(this.options.attentionAnimation);var that=this;setTimeout(function(){that.$element.addClass("animated").addClass(that.options.attentionAnimation)},0)}this.focus()},destroy:function(){var e=$.Event("destroy");this.$element.trigger(e),e.isDefaultPrevented()||(this.$element.off(".modal").removeData("modal").removeClass("in").attr("aria-hidden",!0),this.$parent!==this.$element.parent()?this.$element.appendTo(this.$parent):this.$parent.length||(this.$element.remove(),this.$element=null),this.$element.trigger("destroyed"))}},$.fn.modal=function(option,args){return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),"object"==typeof option&&option);data||$this.data("modal",data=new Modal(this,options)),"string"==typeof option?data[option].apply(data,[].concat(args)):options.show&&data.show()})},$.fn.modal.defaults={keyboard:!0,backdrop:!0,loading:!1,show:!0,width:null,height:null,maxHeight:null,modalOverflow:!1,consumeTab:!0,focusOn:null,replace:!1,resize:!1,attentionAnimation:"shake",manager:"body",spinner:'<div class="loading-spinner" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>',backdropTemplate:'<div class="modal-backdrop" />'},$.fn.modal.Constructor=Modal,$(function(){$(document).off("click.modal").on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href=$this.attr("href"),$target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());e.preventDefault(),$target.modal(option).one("hide",function(){$this.focus()})})})}(window.jQuery);